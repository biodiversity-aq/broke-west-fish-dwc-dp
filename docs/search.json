[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Exploring DwCA_v2 with marine community measurements dataset",
    "section": "",
    "text": "This is an attempt to map BROKE-West Fish dataset as a marine survey and community measurements use case of the new data model to DwC-DP and explore what information can be retrieve from DwC-DP."
  },
  {
    "objectID": "index.html#introduction",
    "href": "index.html#introduction",
    "title": "Exploring DwCA_v2 with marine community measurements dataset",
    "section": "",
    "text": "This is an attempt to map BROKE-West Fish dataset as a marine survey and community measurements use case of the new data model to DwC-DP and explore what information can be retrieve from DwC-DP."
  },
  {
    "objectID": "index.html#acknowledgement",
    "href": "index.html#acknowledgement",
    "title": "Exploring DwCA_v2 with marine community measurements dataset",
    "section": "Acknowledgement",
    "text": "Acknowledgement\nThis mapping exercise is part of ADVANCE project that is funded by BELSPO (BELSPO project RT/23/ADVANCE).\nDocumenting this mapping exercise in Quarto is inspired by the approach of OBIS USA (Steve Formel and Kylie Hollis)\nWe are grateful and appreciate the various contributions received from the following contributors during this exercise:\n\nJohn Wieczorek\nAnton Van de Putte\nCecilie Svenningsen\nKate Ingenloff\nTim Robertson"
  },
  {
    "objectID": "explore-dwc-dp.html",
    "href": "explore-dwc-dp.html",
    "title": "Explore DwC-DP",
    "section": "",
    "text": "You can load the tables from the RDA files like below and play around with the tables as demonstrated in this page. Any pull request is also welcomed.\n\nlibrary(here)\nlibrary(tidyverse)\n\n\n\n\nYes! Example: Total count of electrona antarctica is recorded in SurveyTargetAbundance table, only a subset was preserved and recorded in this dataset. The preserved fish is recorded in the Material table.\n\n\n\nVery often, we received dataset with measurements performed on a specific body part of an organism. Example: https://www.gbif.org/occurrence/3344249657\n\n\nCurrently, I modeled it using eMoF pointing to the Occurrence with body part in measurementRemarks. Specifying the body part can be done through NERC vocabulary. However, it is a hassle to mint NERC for every body part and body part is specific to a taxon.\nOccurrence table\n\n\n\noccurrenceID\nscientificName\n\n\n\n\nSO_Isotope_1985_2017_1013\nGlabraster antarctica (E.A.Smith, 1876)\n\n\n\neMoF table\n\n\n\n\n\n\n\n\n\n\noccurrenceID\nmeasurementType\nmeasurementValue\nmeasurementUnit\nmeasurementRemarks\n\n\n\n\nSO_Isotope_1985_2017_1013\nThe carbon elemental content measured in the tegument of the considered sea star specimen, expressed in relative percentage of dry mass\n12.28\nrelative percentage of dry mass\ntegument\n\n\n\n\n\n\nYes! Relationship between Materials can be specified through the Material table. Example of a krill eaten by a fish can be modeled within a single Material table\n\n#material %&gt;% filter(str_starts(materialEntityID, \"AAV3FF_00025\"))",
    "crumbs": [
      "Home",
      "Darwin Core Data Package",
      "Exploring DwC-DP"
    ]
  },
  {
    "objectID": "explore-dwc-dp.html#questions",
    "href": "explore-dwc-dp.html#questions",
    "title": "Explore DwC-DP",
    "section": "",
    "text": "You can load the tables from the RDA files like below and play around with the tables as demonstrated in this page. Any pull request is also welcomed.\n\nlibrary(here)\nlibrary(tidyverse)\n\n\n\n\nYes! Example: Total count of electrona antarctica is recorded in SurveyTargetAbundance table, only a subset was preserved and recorded in this dataset. The preserved fish is recorded in the Material table.\n\n\n\nVery often, we received dataset with measurements performed on a specific body part of an organism. Example: https://www.gbif.org/occurrence/3344249657\n\n\nCurrently, I modeled it using eMoF pointing to the Occurrence with body part in measurementRemarks. Specifying the body part can be done through NERC vocabulary. However, it is a hassle to mint NERC for every body part and body part is specific to a taxon.\nOccurrence table\n\n\n\noccurrenceID\nscientificName\n\n\n\n\nSO_Isotope_1985_2017_1013\nGlabraster antarctica (E.A.Smith, 1876)\n\n\n\neMoF table\n\n\n\n\n\n\n\n\n\n\noccurrenceID\nmeasurementType\nmeasurementValue\nmeasurementUnit\nmeasurementRemarks\n\n\n\n\nSO_Isotope_1985_2017_1013\nThe carbon elemental content measured in the tegument of the considered sea star specimen, expressed in relative percentage of dry mass\n12.28\nrelative percentage of dry mass\ntegument\n\n\n\n\n\n\nYes! Relationship between Materials can be specified through the Material table. Example of a krill eaten by a fish can be modeled within a single Material table\n\n#material %&gt;% filter(str_starts(materialEntityID, \"AAV3FF_00025\"))",
    "crumbs": [
      "Home",
      "Darwin Core Data Package",
      "Exploring DwC-DP"
    ]
  },
  {
    "objectID": "generate-dwc-dp.html",
    "href": "generate-dwc-dp.html",
    "title": "Transform dataset into DwC-DP",
    "section": "",
    "text": "The mapping is based on schema from https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/",
    "crumbs": [
      "Home",
      "Darwin Core Data Package",
      "Generate tables for DwC-DP"
    ]
  },
  {
    "objectID": "generate-dwc-dp.html#darwin-core-data-package",
    "href": "generate-dwc-dp.html#darwin-core-data-package",
    "title": "Transform dataset into DwC-DP",
    "section": "",
    "text": "The mapping is based on schema from https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/",
    "crumbs": [
      "Home",
      "Darwin Core Data Package",
      "Generate tables for DwC-DP"
    ]
  },
  {
    "objectID": "generate-dwc-dp.html#clean-fish-data",
    "href": "generate-dwc-dp.html#clean-fish-data",
    "title": "Transform dataset into DwC-DP",
    "section": "Clean fish data",
    "text": "Clean fish data\nClean the fish data so that the fields are ready for use for further manipulation.\n\nlibrary(worrms)\n\ncleaned_fish &lt;- raw_fish_data %&gt;%\n  # exclude those without sample number\n  filter(`Sample number` != \"/\") %&gt;%\n  rename(\n    family = Family,\n    preparations = presrvation,\n    disposition = Location,\n    lifeStage = C1,\n    materialEntityID = `Sample number`,\n    netSize = `Net Size`\n  ) %&gt;%\n  mutate(\n    station_number_cleaned = str_remove_all(`Station number`, \"\\\\s*\"), # Remove white spaces\n    eventID = str_c(\"BROKE_WEST_RMT_\", station_number_cleaned, \"_RMT\", `netSize`), \n    verbatimIdentification = case_when(\n      Species == \"Unidentified\" ~ \"\", \n      Species == \"/\" ~ \"\",\n      TRUE ~ Species),\n    scientificName = case_when(\n      grepl(\" sp\\\\.$\", verbatimIdentification) ~ sub(\" sp\\\\.$\", \"\", verbatimIdentification),\n      # correct typo of scientificName based on WoRMS\n      verbatimIdentification == \"Protomytophum bollini\" ~ \"Protomyctophum bolini\",\n      verbatimIdentification == \"Artedidraco scottsbergi\" ~ \"Artedidraco skottsbergi\",\n      verbatimIdentification == \"Gymnoscophelus braueri\" ~ \"Gymnoscopelus braueri\",\n      # Unidentified == Biota because lifeStage = larvae for these records. Can we be sure that these are fish?\n      Species == \"Unidentified\" ~ \"Biota\", \n      Species == \"/\" ~ \"\",\n      TRUE ~ verbatimIdentification\n    )\n    # no more identificationQualifier, use verbatimIdentification :)\n  )\n  \n# match unique scientificName to WoRMS to obtain LSID of AphiaID\nmatched_taxa &lt;- wm_records_names(unique(cleaned_fish$scientificName)) %&gt;%\n  # the taxon match returns list of lists, this function creates a table of the following fields out of the lists\n  # keep aphiaID for surveyTargetID\n  map_df(~ select(.x, scientificname, lsid, rank, kingdom, AphiaID)) %&gt;%\n  rename(scientificName = scientificname, scientificNameID = lsid, taxonRank = rank)\n\n# join table to get scientificNameID and taxonRank\ncleaned_fish &lt;- cleaned_fish %&gt;% \n  left_join(matched_taxa, by = \"scientificName\")\n\n# preview distinct verbatimIdentification and matched scientificName and scientificNameID from WoRMS\ncleaned_fish %&gt;% distinct(verbatimIdentification, scientificName, scientificNameID, kingdom)",
    "crumbs": [
      "Home",
      "Darwin Core Data Package",
      "Generate tables for DwC-DP"
    ]
  },
  {
    "objectID": "generate-dwc-dp.html#main-tables",
    "href": "generate-dwc-dp.html#main-tables",
    "title": "Transform dataset into DwC-DP",
    "section": "Main tables",
    "text": "Main tables\n\nAgent\nThere is only Anton here because this version of dataset does not contain squid records (from the catch).\n\nagent &lt;- tibble(\n  agentID = \"https://orcid.org/0000-0003-1336-5554\",\n  agentType = \"person\",\n  preferredAgentName = \"Anton Van de Putte\"\n) %&gt;% filter_dataframe_by_json(\"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/agent.json\")\n\n\n\nEvent\nHow do we determine what eventType to use? e.g.Â an Event can be both Survey and MaterialGathering.\n\n# Create subevents with net because it is the lowest event with organisms\nsubevents &lt;- event_google %&gt;%\n  filter(eventID != \"BROKE_WEST\") %&gt;% # Exclude the main event\n  mutate(eventType = \"Survey - net type\") %&gt;% # Set eventType for subevents\n  expand_grid(suffix = c(\"_RMT1\", \"_RMT8\")) %&gt;% # Create subevent suffixes with net size\n  mutate(\n    eventID = paste0(eventID, suffix), # Append suffix to eventID\n    parentEventID = eventID %&gt;% sub(\"_RMT[18]$\", \"\", .) # Assign correct parent\n  ) %&gt;%\n  select(-suffix) # Remove the suffix column\n\n# Combine original and subevents\nevent &lt;- bind_rows(event_google, subevents) %&gt;%\n  filter_dataframe_by_json(\"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/event.json\")\n  \nevent %&gt;% filter(str_starts(eventID, \"BROKE_WEST_RMT_001\")) %&gt;% select(eventID, parentEventID, eventType)\n\n\n  \n\n\n\n\n\nMaterial\nMaterial includes:\n\npreserved individual fish\nstomach content of individual fish\n\nCan stomach content material have collectedBy and collectedByID?\n\nindividual_fish &lt;- cleaned_fish %&gt;% \n  mutate(\n    materialEntityType = \"whole organism\",  \n    collectedBy = \"Anton Van de Putte\",\n    collectedByID = \"https://orcid.org/0000-0003-1336-5554\",\n    identifiedBy = \"Anton Van de Putte\",\n    identifiedByID = \"https://orcid.org/0000-0003-1336-5554\",\n    identificationRemarks = case_when(\n      str_detect(COMMENTS, \"closely resembles\") ~ COMMENTS,\n      str_detect(COMMENTS, \"Protomyctophum\") ~ COMMENTS,\n      TRUE ~ \"\"\n    ),\n    materialEntityRemarks = case_when(\n      str_detect(COMMENTS, \"BROKEN | Check | Microsattelite\") ~ COMMENTS,\n      TRUE ~ \"\"\n    )\n    ) %&gt;% \n  select(\n    materialEntityID, eventID, materialEntityType, preparations, disposition, collectedBy, collectedByID, identifiedBy, identifiedByID, verbatimIdentification, scientificName, scientificNameID, kingdom, taxonRank, identificationRemarks, materialEntityRemarks\n  ) %&gt;% rename(taxonID = scientificNameID) # keep verbatimIdentification, scientificName, scientificNameID, kingdom, taxonRank to construct Identification table\n\nstomach &lt;- raw_stomach %&gt;%\n  rename(stomachItem = `Stomach Item`) %&gt;%\n  mutate(\n    seqNum = sprintf(\"%03d\", row_number()), # zero-padded sequential number\n    materialEntityID = str_c(`Fish ID`, \"_stomach_\", seqNum, \"_\", stomachItem),\n    materialEntityType = case_when(\n      stomachItem == \"St wall\" ~ \"stomach content - st wall\",\n      stomachItem == \"Mucus\" ~ \"stomach content - mucus\",\n      stomachItem == \"Other\" ~ \"stomach content - other\",\n      stomachItem == \"Facet eye\" ~ \"stomach content - facet eye\",\n      stomachItem == \"/\" ~ \"stomach content - empty\",\n      TRUE ~ \"stomach content\"),\n    derivedFromMaterialEntityID = `Fish ID`,\n    derivationType = \"stomach content of\",\n    partOfMaterialEntityID = `Fish ID`,\n    identifiedBy = \"Anton Van de Putte\",\n    identifiedByID = \"https://orcid.org/0000-0003-1336-5554\",\n    verbatimIdentification = case_when(\n      str_detect(stomachItem, \"St wall|Mucus|Other|Facet eye|\\\\/\") ~  \"\",\n      TRUE ~ stomachItem\n    ),\n    identificationRemarks = case_when(str_detect(Remarks, \"cf.\") ~ Remarks, TRUE ~ \"\"),\n    materialEntityRemarks = case_when(str_detect(Remarks, \"cf.\") ~ \"\", TRUE ~ Remarks),\n  ) %&gt;% \n  left_join(individual_fish, by = c(\"derivedFromMaterialEntityID\" = \"materialEntityID\")) %&gt;%\n  # because left_join renamed the following columns since it is present in both individual_fish and stomach table\n  rename(materialEntityType = materialEntityType.x,\n         verbatimIdentification = verbatimIdentification.x,\n         materialEntityRemarks = materialEntityRemarks.x,\n         identificationRemarks = identificationRemarks.x,\n         identifiedBy = identifiedBy.x,\n         identifiedByID = identifiedByID.x) %&gt;% \n  select(materialEntityID, eventID, materialEntityType, identifiedBy, identifiedByID, verbatimIdentification, identificationRemarks, derivedFromMaterialEntityID, derivationType, partOfMaterialEntityID, materialEntityRemarks)\n\n# combine both tables into a Material table\nmaterial_join_identification &lt;- bind_rows(individual_fish, stomach) \n\n# preview example of a full fish + its stomach content in Material table\nmaterial &lt;- material_join_identification %&gt;%\n  filter_dataframe_by_json(\"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/material.json\")\nmaterial %&gt;% filter(str_starts(materialEntityID, \"AAV3FF_00025\"))\n\n\n  \n\n\n\n\n\nIdentification\nIdentification terms are mostly part of Material table.\nQuestion: I am expecting OBIS to ask about why taxonID and not scientificNameID.\n\nfish_id_guide &lt;- \"https://archive.org/details/fishesofsouthern00gono | Kellermann, A. (1990): Identification Key and Catalogue of Larval Antarctic Fishes , Berichte zur Polarforschung (Reports on Polar Research), Bremerhaven, Alfred Wegener Institute for Polar and Marine Research, 67 , 136 p. . doi: 10.2312/BzP_0067_1990 | https://archive.org/details/cybium-7-002-003-074\"\n\nidentification &lt;- material_join_identification %&gt;%\n  mutate(\n    identificationID = paste(materialEntityID, \"ID\", sep = \"_\"),\n    identificationBasedOnMaterialEntityID = materialEntityID,\n    identificationType = \"MaterialEntity\",\n    identificationTypeIRI = \"http://rs.tdwg.org/dwc/terms/MaterialEntity\",\n    identifiedBy = \"Anton Van de Putte\",\n    identifiedByID = \"https://orcid.org/0000-0003-1336-5554\",\n    identificationReferences = fish_id_guide) %&gt;%\n  filter_dataframe_by_json(\"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/identification.json\")\nhead(identification)\n\n\n  \n\n\n\n\n\nMedia\n\nmedia_material &lt;- media_google %&gt;% \n  # also needed to construct Material Media table later\n  left_join(material, by = \"materialEntityID\") %&gt;% \n  # remove these media records because there is no data associated with these pictures -&gt; we don't know what these are\n  filter(!is.na(eventID)) %&gt;%\n  mutate(mediaDescription = str_c(\"Photo of \", scientificName, \" with its label and a grid.\")) \n\nmedia &lt;- filter_dataframe_by_json(media_material, \"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/media.json\")\nhead(media)\n\n\n  \n\n\n\n\n\nSurvey\nSurvey table is a table that contains current Humboldt Extension terms.\n\nsuffixes &lt;- c(\"_RMT1\",\"_RMT8\")\n\nsurvey_w_protocol &lt;- humboldt %&gt;%\n  filter(eventID != \"BROKE_WEST\") %&gt;% # remove the expedition event, only link humboldt to the lowest level of Survey Events\n  expand_grid(suffix = suffixes) %&gt;%\n  mutate(eventID = paste0(eventID, suffix),\n         # need to cast netSize to string so that it can be joined later (so that it is not a double)\n         netSize = case_when(suffix == \"_RMT1\" ~ \"1\", suffix == \"_RMT8\" ~ \"8\", TRUE ~ NA),\n         surveyID = eventID,\n         isLeastSpecificTargetCategoryQuantityInclusive = \"true\") \n\nsurvey &lt;- survey_w_protocol %&gt;%\n  filter_dataframe_by_json(\"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/survey.json\")\nhead(survey)\n\n\n  \n\n\n\n\n\nProtocol\n\nprotocol &lt;- filter_dataframe_by_json(protocol, \"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/protocol.json\")\nprotocol\n\n\n  \n\n\n\n\n\nSurvey Target & Occurrence\nAfter extensive discussions on what target is, we decided to create survey-target table retrospectively. SurveyTarget needs to be created per net size because it is linked to a Survey (lowest level of Survey is per net size) via SurveyID. SurveyTargetAbundance points to the Survey through the SurveyTarget record.\nChallenge: There is only total count for fish from RMT8 and not RMT1. The total count also does not contain any sex and lifeStage for all the taxa except Electrona antarctica.\n\ntransform_rmt_count_to_long &lt;- function(df){\n  #' Convert wide count table into long table\n  #' \n  #' @param df A tibble of the count table with taxon as columns and trawl event as rows\n  #' @return A list of 2 tibbles, one is survey_target, the other is survey_target_abundance table\n  trawl &lt;- df %&gt;%\n  pivot_longer(cols = 5:ncol(df),\n               names_to = \"verbatimIdentification\",\n               values_to = \"organismQuantity\",\n               values_drop_na = TRUE) %&gt;%\n  mutate(\n    organismQuantityType = case_when(organismQuantity &gt;= 1 ~ \"individuals\", TRUE ~ \"individual\"),\n    life_stage = case_when(\n      str_detect(verbatimIdentification, \" all$\") ~ \"\",\n      str_detect(verbatimIdentification, \" Larvae$\") ~ \"Larvae\",\n      str_detect(verbatimIdentification, \" Postmeta$\") ~ \"Postmeta\",\n      TRUE ~ \"\"\n    ),\n    lifeStage = life_stage, # create extra lifeStage column for occurrence table\n    # use field name \"taxon\" for surveyTargetType vocabulary later\n    taxon = str_remove_all(verbatimIdentification, \"\\\\s*(all|Larvae|Postmeta|sp\\\\.)$\"),\n    station_number_cleaned = str_remove_all(`Station number`, \"\\\\s*\"), # Remove white spaces\n    surveyID = str_c(\"BROKE_WEST_RMT_\", station_number_cleaned, \"_RMT8\"),\n    # need to cast body size to string otherwise double cannot be in the same column with string after pivot_long\n    # only use size range for RMT8 here because there is no count data for RMT1 \n    `minimum body size` = \"0.85\",\n    `maximum body size` = \"3\"\n  )\n\ntrawl_taxa &lt;- wm_records_names(unique(trawl$taxon)) %&gt;%\n  # the taxon match returns list of lists, this function creates a table of the following fields out of the lists\n  map_df(~ select(.x, scientificname, lsid, AphiaID, rank, kingdom)) %&gt;%\n  rename(taxon = scientificname, taxonID = lsid, taxonRank = rank) %&gt;%\n  mutate(taxon_rank = taxonRank) # create extra taxonRank column for occurrence table\n\ntrawl_count &lt;- trawl %&gt;% \n  left_join(trawl_taxa, by = \"taxon\") %&gt;%\n  mutate(surveyTargetID = case_when(\n    lifeStage != \"\" ~ str_c(AphiaID, lifeStage, sep = \"_\"),\n    TRUE ~ as.character(AphiaID)))\n\ntrawl_long &lt;- trawl_count %&gt;%\n  pivot_longer(\n    cols = c(\"taxon\", \"life_stage\", \"taxon_rank\", \"minimum body size\", \"maximum body size\"),\n    names_to = \"surveyTargetType\",\n    values_to = \"surveyTargetValue\",\n    values_drop_na = TRUE\n  ) %&gt;%\n  mutate(\n    surveyTargetUnit = case_when(\n      surveyTargetType == \"minimum body size\" ~ \"mm\",\n      surveyTargetType == \"maximum body size\" ~ \"m\",\n      TRUE ~ NA\n    ),\n    surveyTargetUnitIRI = case_when(\n      surveyTargetUnit == \"mm\" ~ \"http://vocab.nerc.ac.uk/collection/P06/current/UXMM/\",\n      surveyTargetUnit == \"m\" ~ \"http://vocab.nerc.ac.uk/collection/P06/current/ULAA/\",\n      TRUE ~ NA\n    ),\n    surveyTargetValueIRI = case_when(\n      surveyTargetType == \"taxon\" ~ taxonID,\n      surveyTargetValue == \"Genus\" ~ \"http://rs.tdwg.org/dwc/terms/genus\",\n      surveyTargetValue == \"Species\" ~ \"http://rs.tdwg.org/dwc/terms/specificEpithet\",\n      surveyTargetValue == \"Family\" ~ \"http://rs.tdwg.org/dwc/terms/family\",\n      TRUE ~ NA\n    ),\n    surveyTargetType = case_when(\n      surveyTargetType == \"life_stage\" ~ \"life stage\",\n      surveyTargetType == \"taxon_rank\" ~ \"taxon rank\",\n      TRUE ~ surveyTargetType\n    ),\n    includeOrExclude = \"include\",\n    isSurveyTargetFullyReported = \"true\"\n  ) %&gt;% filter(!(surveyTargetType == \"life stage\" & surveyTargetValue == \"\")) # remove empty lifeStage row\n\nsurvey_target &lt;- trawl_long %&gt;%\n  select(surveyTargetID, surveyID, surveyTargetType, surveyTargetValue, surveyTargetValueIRI, surveyTargetUnit, surveyTargetUnitIRI)\n\noccurrence &lt;- trawl_long %&gt;%\n  filter(surveyTargetType == \"taxon\" & organismQuantity != 0) %&gt;%\n  rename(\n    scientificName = surveyTargetValue, \n    eventID = surveyID) %&gt;%\n  mutate(\n    occurrenceStatus = \"present\",\n    recordedBy = \"Anton Van de Putte\",\n    recordedByID = \"https://orcid.org/0000-0003-1336-5554\",\n    identifiedBy = \"Anton Van de Putte\",\n    identifiedByID = \"https://orcid.org/0000-0003-1336-5554\",\n  )\nreturn(list(survey_target = survey_target, occurrence = occurrence))\n}\n\nroutine_trawl &lt;- transform_rmt_count_to_long(raw_count_routine)\ntarget_trawl &lt;- transform_rmt_count_to_long(raw_count_target)\n\nsurvey_target &lt;- rbind(routine_trawl$survey_target, target_trawl$survey_target) %&gt;%\n  filter_dataframe_by_json(\"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/survey-target.json\")\noccurrence &lt;- rbind(routine_trawl$occurrence, target_trawl$occurrence) %&gt;%\n  mutate(occurrenceID = str_c(eventID, surveyTargetID, sep = \"_\")) %&gt;%\n  filter_dataframe_by_json(\"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/occurrence.json\")\n\n# preview example tables\nhead(survey_target)\n\n\n  \n\n\nhead(occurrence)",
    "crumbs": [
      "Home",
      "Darwin Core Data Package",
      "Generate tables for DwC-DP"
    ]
  },
  {
    "objectID": "generate-dwc-dp.html#common-tables",
    "href": "generate-dwc-dp.html#common-tables",
    "title": "Transform dataset into DwC-DP",
    "section": "Common tables",
    "text": "Common tables\n\nAgent role\n\nAgent Agent role\n\nagent_agent_role &lt;- tibble(\n  agentID = \"https://orcid.org/0000-0003-1336-5554\",\n  agentRole = \"collector\",\n) %&gt;% filter_dataframe_by_json(\"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/agent-agent-role.json\")\nagent_agent_role\n\n\n  \n\n\n\n\n\nTable not needed: Event Agent role\n\n\nTable not needed: Identification Agent role\nThe event_agent_roles and identification_agent_roles arenât actually necessary because those roles are hard-wired elsewhere in the schema in a simpler way. Specifically, identification has identifiedBy and identifiedByID, which can be populated directly with the name and the ORCID. Similarly with collectedBy and collectorID in the material table.\n\n\nTable not needed: Survey Agent role\nNot needed because it can be represented by samplingPerformedBy and samplingPerformedByID.\n\n\n\nAssertion\n\nEvent Assertion\nPlacing environmental measurements under Event Assertion instead of Survey Assertion because it is for both RMT1 and RMT8. Putting this at the level of station Event and not net Event.\nExpedition\n|__ Sampling station\n    |__ RMT1\n    |__ RMT8\n\nassertion &lt;- emof %&gt;% \n  rename(assertionID = measurementID, assertionType = measurementType, assertionTypeIRI = measurementTypeID, assertionValueIRI = measurementValueID, assertionUnit = measurementUnit, assertionUnitIRI = measurementUnitID) %&gt;%\n  mutate(assertionValue = if_else(grepl(\"[a-zA-Z]\", measurementValue), measurementValue, NA),\n    assertionValueNumeric = if_else(!grepl(\"[a-zA-Z]\", measurementValue), as.numeric(measurementValue), NA))\n\nevent_assertion &lt;- assertion %&gt;% \n  filter(is.na(occurrenceID)) %&gt;%\n  mutate(\n    assertionTypeVocabulary = \"http://vocab.nerc.ac.uk/collection/P01/current/\",\n    assertionProtocol = case_when(\n      assertionType %in% c(\"Average temperature\", \"Maximum Pressure\", \"Average Salinity\", \"Average Conductivity\", \"Average fluoresence\") ~ \"CTD\",\n      assertionType %in% c(\"Solar Azimuth\", \"Solar elevation\", \"daylength\") ~ \"solar azimuth, elevation and day length\",\n      TRUE ~ \"\"),\n    assertionProtocolID = case_when(\n      assertionProtocol == \"CTD\" ~ \"ctd\",\n      assertionProtocol == \"solar azimuth, elevation and day length\" ~ \"light_conditions\",\n      TRUE ~ \"\"),\n    assertionUnitVocabulary = \"http://vocab.nerc.ac.uk/collection/P06/current/\" \n    ) %&gt;%\n  filter_dataframe_by_json(\"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/event-assertion.json\")\nevent_assertion %&gt;% filter(assertionID == \"BROKE_WEST_RMT_028_temp\")\n\n\n  \n\n\n\n\n\nMaterial Assertion\n\nmaterial_assertion &lt;- assertion %&gt;% \n  filter(!is.na(occurrenceID)) %&gt;%\n  rename(materialEntityID = occurrenceID) %&gt;%\n  filter_dataframe_by_json(\"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/material-assertion.json\")\nmaterial_assertion %&gt;% filter(materialEntityID == \"AAV3FF_00001\")\n\n\n  \n\n\n\n\n\n\nMedia\n\nMaterial Media\n\nmaterial_media &lt;- media_material %&gt;%\n  mutate(mediaSubjectCategory = \"specimen photo\") %&gt;%\n  filter_dataframe_by_json(\"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/material-media.json\")\nhead(material_media)\n\n\n  \n\n\n\n\n\n\nProtocol\n\nSurvey Protocol\nAs Event is also a Survey, I use Survey Protocol table instead of Event Protocol table.\n\nsurvey_protocol &lt;- survey_w_protocol %&gt;% \n  select(surveyID, samplingProtocol) %&gt;% \n  rename(protocolID = samplingProtocol) %&gt;%\n  filter(!is.na(protocolID))\nsurvey_protocol %&gt;% filter(surveyID == \"BROKE_WEST_RMT_001_RMT8\")\n\n\n  \n\n\n\n\n\n\nIdentifier\n\nAgent Identifier\n\nagent_identifier &lt;- tibble(\n  identifier = \"https://orcid.org/0000-0003-1336-5554\",\n  agentID = \"https://orcid.org/0000-0003-1336-5554\",\n  identifierType = \"ORCID\",\n  identifierLanguage = \"eng\"\n) %&gt;% filter_dataframe_by_json(\"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/agent-identifier.json\")\nagent_identifier",
    "crumbs": [
      "Home",
      "Darwin Core Data Package",
      "Generate tables for DwC-DP"
    ]
  }
]