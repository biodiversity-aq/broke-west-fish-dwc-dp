<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-02-28">

<title>Transform dataset into DwC-DP â€“ BROKE-West fish to DwCA v2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./explore-dwc-dp.html" rel="next">
<link href="./dataset-background.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-3f13cc09417cf69baaf74afa0e2e3cf6.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">BROKE-West fish to DwCA v2</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/biodiversity-aq/broke-west-fish-dwcav2"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./generate-dwc-dp.html">Darwin Core Data Package</a></li><li class="breadcrumb-item"><a href="./generate-dwc-dp.html">Generate tables for DwC-DP</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Background</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dataset-background.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dataset background</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Darwin Core Data Package</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./generate-dwc-dp.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Generate tables for DwC-DP</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./explore-dwc-dp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exploring DwC-DP</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#darwin-core-data-package" id="toc-darwin-core-data-package" class="nav-link active" data-scroll-target="#darwin-core-data-package">Darwin Core Data Package</a></li>
  <li><a href="#clean-fish-data" id="toc-clean-fish-data" class="nav-link" data-scroll-target="#clean-fish-data">Clean fish data</a></li>
  <li><a href="#main-tables" id="toc-main-tables" class="nav-link" data-scroll-target="#main-tables">Main tables</a>
  <ul class="collapse">
  <li><a href="#agent" id="toc-agent" class="nav-link" data-scroll-target="#agent">Agent</a></li>
  <li><a href="#event" id="toc-event" class="nav-link" data-scroll-target="#event">Event</a></li>
  <li><a href="#material" id="toc-material" class="nav-link" data-scroll-target="#material">Material</a></li>
  <li><a href="#identification" id="toc-identification" class="nav-link" data-scroll-target="#identification">Identification</a></li>
  <li><a href="#media" id="toc-media" class="nav-link" data-scroll-target="#media">Media</a></li>
  <li><a href="#survey" id="toc-survey" class="nav-link" data-scroll-target="#survey">Survey</a></li>
  <li><a href="#protocol" id="toc-protocol" class="nav-link" data-scroll-target="#protocol">Protocol</a></li>
  <li><a href="#survey-target-occurrence" id="toc-survey-target-occurrence" class="nav-link" data-scroll-target="#survey-target-occurrence">Survey Target &amp; Occurrence</a></li>
  </ul></li>
  <li><a href="#common-tables" id="toc-common-tables" class="nav-link" data-scroll-target="#common-tables">Common tables</a>
  <ul class="collapse">
  <li><a href="#agent-role" id="toc-agent-role" class="nav-link" data-scroll-target="#agent-role">Agent role</a></li>
  <li><a href="#assertion" id="toc-assertion" class="nav-link" data-scroll-target="#assertion">Assertion</a></li>
  <li><a href="#media-1" id="toc-media-1" class="nav-link" data-scroll-target="#media-1">Media</a></li>
  <li><a href="#protocol-1" id="toc-protocol-1" class="nav-link" data-scroll-target="#protocol-1">Protocol</a></li>
  <li><a href="#identifier" id="toc-identifier" class="nav-link" data-scroll-target="#identifier">Identifier</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./generate-dwc-dp.html">Darwin Core Data Package</a></li><li class="breadcrumb-item"><a href="./generate-dwc-dp.html">Generate tables for DwC-DP</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Transform dataset into DwC-DP</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 28, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="darwin-core-data-package" class="level2">
<h2 class="anchored" data-anchor-id="darwin-core-data-package">Darwin Core Data Package</h2>
<p>The mapping is based on schema from <a href="https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/" class="uri">https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/</a></p>
</section>
<section id="clean-fish-data" class="level2">
<h2 class="anchored" data-anchor-id="clean-fish-data">Clean fish data</h2>
<p>Clean the fish data so that the fields are ready for use for further manipulation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(worrms)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>cleaned_fish <span class="ot">&lt;-</span> raw_fish_data <span class="sc">%&gt;%</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># exclude those without sample number</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">Sample number</span><span class="st">`</span> <span class="sc">!=</span> <span class="st">"/"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> Family,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">preparations =</span> presrvation,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">disposition =</span> Location,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">lifeStage =</span> C1,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">materialEntityID =</span> <span class="st">`</span><span class="at">Sample number</span><span class="st">`</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">netSize =</span> <span class="st">`</span><span class="at">Net Size</span><span class="st">`</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">station_number_cleaned =</span> <span class="fu">str_remove_all</span>(<span class="st">`</span><span class="at">Station number</span><span class="st">`</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">s*"</span>), <span class="co"># Remove white spaces</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">eventID =</span> <span class="fu">str_c</span>(<span class="st">"BROKE_WEST_RMT_"</span>, station_number_cleaned, <span class="st">"_RMT"</span>, <span class="st">`</span><span class="at">netSize</span><span class="st">`</span>), </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbatimIdentification =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>      Species <span class="sc">==</span> <span class="st">"Unidentified"</span> <span class="sc">~</span> <span class="st">""</span>, </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>      Species <span class="sc">==</span> <span class="st">"/"</span> <span class="sc">~</span> <span class="st">""</span>,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> Species),</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">scientificName =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">" sp</span><span class="sc">\\</span><span class="st">.$"</span>, verbatimIdentification) <span class="sc">~</span> <span class="fu">sub</span>(<span class="st">" sp</span><span class="sc">\\</span><span class="st">.$"</span>, <span class="st">""</span>, verbatimIdentification),</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>      <span class="co"># correct typo of scientificName based on WoRMS</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>      verbatimIdentification <span class="sc">==</span> <span class="st">"Protomytophum bollini"</span> <span class="sc">~</span> <span class="st">"Protomyctophum bolini"</span>,</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>      verbatimIdentification <span class="sc">==</span> <span class="st">"Artedidraco scottsbergi"</span> <span class="sc">~</span> <span class="st">"Artedidraco skottsbergi"</span>,</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>      verbatimIdentification <span class="sc">==</span> <span class="st">"Gymnoscophelus braueri"</span> <span class="sc">~</span> <span class="st">"Gymnoscopelus braueri"</span>,</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Unidentified == Biota because lifeStage = larvae for these records. Can we be sure that these are fish?</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>      Species <span class="sc">==</span> <span class="st">"Unidentified"</span> <span class="sc">~</span> <span class="st">"Biota"</span>, </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>      Species <span class="sc">==</span> <span class="st">"/"</span> <span class="sc">~</span> <span class="st">""</span>,</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> verbatimIdentification</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no more identificationQualifier, use verbatimIdentification :)</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co"># match unique scientificName to WoRMS to obtain LSID of AphiaID</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>matched_taxa <span class="ot">&lt;-</span> <span class="fu">wm_records_names</span>(<span class="fu">unique</span>(cleaned_fish<span class="sc">$</span>scientificName)) <span class="sc">%&gt;%</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the taxon match returns list of lists, this function creates a table of the following fields out of the lists</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># keep aphiaID for surveyTargetID</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_df</span>(<span class="sc">~</span> <span class="fu">select</span>(.x, scientificname, lsid, rank, kingdom, AphiaID)) <span class="sc">%&gt;%</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">scientificName =</span> scientificname, <span class="at">scientificNameID =</span> lsid, <span class="at">taxonRank =</span> rank)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="co"># join table to get scientificNameID and taxonRank</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>cleaned_fish <span class="ot">&lt;-</span> cleaned_fish <span class="sc">%&gt;%</span> </span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(matched_taxa, <span class="at">by =</span> <span class="st">"scientificName"</span>)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="co"># preview distinct verbatimIdentification and matched scientificName and scientificNameID from WoRMS</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>cleaned_fish <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(verbatimIdentification, scientificName, scientificNameID, kingdom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["verbatimIdentification"],"name":[1],"type":["chr"],"align":["left"]},{"label":["scientificName"],"name":[2],"type":["chr"],"align":["left"]},{"label":["scientificNameID"],"name":[3],"type":["chr"],"align":["left"]},{"label":["kingdom"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"Bathydraco sp.","2":"Bathydraco","3":"urn:lsid:marinespecies.org:taxname:234552","4":"Animalia"},{"1":"Pogonophryne marmorata","2":"Pogonophryne marmorata","3":"urn:lsid:marinespecies.org:taxname:234730","4":"Animalia"},{"1":"Cygnodraco mawsoni","2":"Cygnodraco mawsoni","3":"urn:lsid:marinespecies.org:taxname:234834","4":"Animalia"},{"1":"Electrona antarctica","2":"Electrona antarctica","3":"urn:lsid:marinespecies.org:taxname:217697","4":"Animalia"},{"1":"Notolepis coatsi","2":"Notolepis coatsi","3":"urn:lsid:marinespecies.org:taxname:234695","4":"Animalia"},{"1":"Pleuragramma antarcticum","2":"Pleuragramma antarcticum","3":"urn:lsid:marinespecies.org:taxname:234721","4":"Animalia"},{"1":"Trematomus sp.","2":"Trematomus","3":"urn:lsid:marinespecies.org:taxname:234566","4":"Animalia"},{"1":"Chionodraco sp.","2":"Chionodraco","3":"urn:lsid:marinespecies.org:taxname:234582","4":"Animalia"},{"1":"Gymnodraco acuticeps","2":"Gymnodraco acuticeps","3":"urn:lsid:marinespecies.org:taxname:234800","4":"Animalia"},{"1":"Pagetopsis maculatus","2":"Pagetopsis maculatus","3":"urn:lsid:marinespecies.org:taxname:1621601","4":"Animalia"},{"1":"Cryodraco antarcticus","2":"Cryodraco antarcticus","3":"urn:lsid:marinespecies.org:taxname:234720","4":"Animalia"},{"1":"","2":"Biota","3":"urn:lsid:marinespecies.org:taxname:1","4":"NA"},{"1":"Prionodraco evansii","2":"Prionodraco evansii","3":"urn:lsid:marinespecies.org:taxname:234777","4":"Animalia"},{"1":"Protomytophum bollini","2":"Protomyctophum bolini","3":"urn:lsid:marinespecies.org:taxname:234714","4":"Animalia"},{"1":"Artedidraco scottsbergi","2":"Artedidraco skottsbergi","3":"urn:lsid:marinespecies.org:taxname:234621","4":"Animalia"},{"1":"Gerlachea australis","2":"Gerlachea australis","3":"urn:lsid:marinespecies.org:taxname:234808","4":"Animalia"},{"1":"Gymnoscophelus braueri","2":"Gymnoscopelus braueri","3":"urn:lsid:marinespecies.org:taxname:234642","4":"Animalia"},{"1":"Macrouridae sp.","2":"Macrouridae","3":"urn:lsid:marinespecies.org:taxname:125471","4":"Animalia"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="main-tables" class="level2">
<h2 class="anchored" data-anchor-id="main-tables">Main tables</h2>
<section id="agent" class="level3">
<h3 class="anchored" data-anchor-id="agent">Agent</h3>
<p>There is only Anton here because this version of dataset does not contain squid records (from the catch).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>agent <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">agentID =</span> <span class="st">"https://orcid.org/0000-0003-1336-5554"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">agentType =</span> <span class="st">"person"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">preferredAgentName =</span> <span class="st">"Anton Van de Putte"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">filter_dataframe_by_json</span>(<span class="st">"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/agent.json"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="event" class="level3">
<h3 class="anchored" data-anchor-id="event">Event</h3>
<p>How do we determine what <code>eventType</code> to use? e.g.&nbsp;an Event can be both <code>Survey</code> and <code>MaterialGathering</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create subevents with net because it is the lowest event with organisms</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>subevents <span class="ot">&lt;-</span> event_google <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(eventID <span class="sc">!=</span> <span class="st">"BROKE_WEST"</span>) <span class="sc">%&gt;%</span> <span class="co"># Exclude the main event</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">eventType =</span> <span class="st">"Survey - net type"</span>) <span class="sc">%&gt;%</span> <span class="co"># Set eventType for subevents</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_RMT1"</span>, <span class="st">"_RMT8"</span>)) <span class="sc">%&gt;%</span> <span class="co"># Create subevent suffixes with net size</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">eventID =</span> <span class="fu">paste0</span>(eventID, suffix), <span class="co"># Append suffix to eventID</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">parentEventID =</span> eventID <span class="sc">%&gt;%</span> <span class="fu">sub</span>(<span class="st">"_RMT[18]$"</span>, <span class="st">""</span>, .) <span class="co"># Assign correct parent</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>suffix) <span class="co"># Remove the suffix column</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine original and subevents</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>event <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(event_google, subevents) <span class="sc">%&gt;%</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_dataframe_by_json</span>(<span class="st">"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/event.json"</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>event <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">str_starts</span>(eventID, <span class="st">"BROKE_WEST_RMT_001"</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(eventID, parentEventID, eventType)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["eventID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["parentEventID"],"name":[2],"type":["chr"],"align":["left"]},{"label":["eventType"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"BROKE_WEST_RMT_001","2":"BROKE_WEST","3":"Survey"},{"1":"BROKE_WEST_RMT_001_RMT1","2":"BROKE_WEST_RMT_001","3":"Survey - net type"},{"1":"BROKE_WEST_RMT_001_RMT8","2":"BROKE_WEST_RMT_001","3":"Survey - net type"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="material" class="level3">
<h3 class="anchored" data-anchor-id="material">Material</h3>
<p>Material includes:</p>
<ul>
<li>preserved individual fish</li>
<li>stomach content of individual fish</li>
</ul>
<p>Can stomach content material have <code>collectedBy</code> and <code>collectedByID</code>?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>individual_fish <span class="ot">&lt;-</span> cleaned_fish <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">materialEntityType =</span> <span class="st">"whole organism"</span>,  </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">collectedBy =</span> <span class="st">"Anton Van de Putte"</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">collectedByID =</span> <span class="st">"https://orcid.org/0000-0003-1336-5554"</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">identifiedBy =</span> <span class="st">"Anton Van de Putte"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">identifiedByID =</span> <span class="st">"https://orcid.org/0000-0003-1336-5554"</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">identificationRemarks =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(COMMENTS, <span class="st">"closely resembles"</span>) <span class="sc">~</span> COMMENTS,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(COMMENTS, <span class="st">"Protomyctophum"</span>) <span class="sc">~</span> COMMENTS,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">materialEntityRemarks =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(COMMENTS, <span class="st">"BROKEN | Check | Microsattelite"</span>) <span class="sc">~</span> COMMENTS,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    materialEntityID, eventID, materialEntityType, preparations, disposition, collectedBy, collectedByID, identifiedBy, identifiedByID, verbatimIdentification, scientificName, scientificNameID, kingdom, taxonRank, identificationRemarks, materialEntityRemarks</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">taxonID =</span> scientificNameID) <span class="co"># keep verbatimIdentification, scientificName, scientificNameID, kingdom, taxonRank to construct Identification table</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>stomach <span class="ot">&lt;-</span> raw_stomach <span class="sc">%&gt;%</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">stomachItem =</span> <span class="st">`</span><span class="at">Stomach Item</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">seqNum =</span> <span class="fu">sprintf</span>(<span class="st">"%03d"</span>, <span class="fu">row_number</span>()), <span class="co"># zero-padded sequential number</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">materialEntityID =</span> <span class="fu">str_c</span>(<span class="st">`</span><span class="at">Fish ID</span><span class="st">`</span>, <span class="st">"_stomach_"</span>, seqNum, <span class="st">"_"</span>, stomachItem),</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">materialEntityType =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>      stomachItem <span class="sc">==</span> <span class="st">"St wall"</span> <span class="sc">~</span> <span class="st">"stomach content - st wall"</span>,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>      stomachItem <span class="sc">==</span> <span class="st">"Mucus"</span> <span class="sc">~</span> <span class="st">"stomach content - mucus"</span>,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>      stomachItem <span class="sc">==</span> <span class="st">"Other"</span> <span class="sc">~</span> <span class="st">"stomach content - other"</span>,</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>      stomachItem <span class="sc">==</span> <span class="st">"Facet eye"</span> <span class="sc">~</span> <span class="st">"stomach content - facet eye"</span>,</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>      stomachItem <span class="sc">==</span> <span class="st">"/"</span> <span class="sc">~</span> <span class="st">"stomach content - empty"</span>,</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"stomach content"</span>),</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">derivedFromMaterialEntityID =</span> <span class="st">`</span><span class="at">Fish ID</span><span class="st">`</span>,</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">derivationType =</span> <span class="st">"stomach content of"</span>,</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">partOfMaterialEntityID =</span> <span class="st">`</span><span class="at">Fish ID</span><span class="st">`</span>,</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">identifiedBy =</span> <span class="st">"Anton Van de Putte"</span>,</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">identifiedByID =</span> <span class="st">"https://orcid.org/0000-0003-1336-5554"</span>,</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbatimIdentification =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(stomachItem, <span class="st">"St wall|Mucus|Other|Facet eye|</span><span class="sc">\\</span><span class="st">/"</span>) <span class="sc">~</span>  <span class="st">""</span>,</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> stomachItem</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">identificationRemarks =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(Remarks, <span class="st">"cf."</span>) <span class="sc">~</span> Remarks, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span>),</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">materialEntityRemarks =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(Remarks, <span class="st">"cf."</span>) <span class="sc">~</span> <span class="st">""</span>, <span class="cn">TRUE</span> <span class="sc">~</span> Remarks),</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(individual_fish, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"derivedFromMaterialEntityID"</span> <span class="ot">=</span> <span class="st">"materialEntityID"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># because left_join renamed the following columns since it is present in both individual_fish and stomach table</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">materialEntityType =</span> materialEntityType.x,</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>         <span class="at">verbatimIdentification =</span> verbatimIdentification.x,</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>         <span class="at">materialEntityRemarks =</span> materialEntityRemarks.x,</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>         <span class="at">identificationRemarks =</span> identificationRemarks.x,</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>         <span class="at">identifiedBy =</span> identifiedBy.x,</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>         <span class="at">identifiedByID =</span> identifiedByID.x) <span class="sc">%&gt;%</span> </span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(materialEntityID, eventID, materialEntityType, identifiedBy, identifiedByID, verbatimIdentification, identificationRemarks, derivedFromMaterialEntityID, derivationType, partOfMaterialEntityID, materialEntityRemarks)</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a><span class="co"># combine both tables into a Material table</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>material_join_identification <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(individual_fish, stomach) </span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a><span class="co"># preview example of a full fish + its stomach content in Material table</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>material <span class="ot">&lt;-</span> material_join_identification <span class="sc">%&gt;%</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_dataframe_by_json</span>(<span class="st">"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/material.json"</span>)</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>material <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">str_starts</span>(materialEntityID, <span class="st">"AAV3FF_00025"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["materialEntityID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["eventID"],"name":[2],"type":["chr"],"align":["left"]},{"label":["materialEntityType"],"name":[3],"type":["chr"],"align":["left"]},{"label":["collectedBy"],"name":[4],"type":["chr"],"align":["left"]},{"label":["collectedByID"],"name":[5],"type":["chr"],"align":["left"]},{"label":["preparations"],"name":[6],"type":["chr"],"align":["left"]},{"label":["disposition"],"name":[7],"type":["chr"],"align":["left"]},{"label":["materialEntityRemarks"],"name":[8],"type":["chr"],"align":["left"]},{"label":["derivedFromMaterialEntityID"],"name":[9],"type":["chr"],"align":["left"]},{"label":["derivationType"],"name":[10],"type":["chr"],"align":["left"]},{"label":["partOfMaterialEntityID"],"name":[11],"type":["chr"],"align":["left"]},{"label":["verbatimIdentification"],"name":[12],"type":["chr"],"align":["left"]},{"label":["identifiedBy"],"name":[13],"type":["chr"],"align":["left"]},{"label":["identifiedByID"],"name":[14],"type":["chr"],"align":["left"]},{"label":["identificationRemarks"],"name":[15],"type":["chr"],"align":["left"]},{"label":["taxonID"],"name":[16],"type":["chr"],"align":["left"]},{"label":["kingdom"],"name":[17],"type":["chr"],"align":["left"]},{"label":["scientificName"],"name":[18],"type":["chr"],"align":["left"]},{"label":["taxonRank"],"name":[19],"type":["chr"],"align":["left"]}],"data":[{"1":"AAV3FF_00025","2":"BROKE_WEST_RMT_022_RMT8","3":"whole organism","4":"Anton Van de Putte","5":"https://orcid.org/0000-0003-1336-5554","6":"formalin","7":"Anton","8":"","9":"NA","10":"NA","11":"NA","12":"Pleuragramma antarcticum","13":"Anton Van de Putte","14":"https://orcid.org/0000-0003-1336-5554","15":"","16":"urn:lsid:marinespecies.org:taxname:234721","17":"Animalia","18":"Pleuragramma antarcticum","19":"Species"},{"1":"AAV3FF_00025_stomach_018_Copepod","2":"BROKE_WEST_RMT_022_RMT8","3":"stomach content","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"AAV3FF_00025","10":"stomach content of","11":"AAV3FF_00025","12":"Copepod","13":"Anton Van de Putte","14":"https://orcid.org/0000-0003-1336-5554","15":"","16":"NA","17":"NA","18":"NA","19":"NA"},{"1":"AAV3FF_00025_stomach_019_Crustecean","2":"BROKE_WEST_RMT_022_RMT8","3":"stomach content","4":"NA","5":"NA","6":"NA","7":"NA","8":"rear part; long tail spine","9":"AAV3FF_00025","10":"stomach content of","11":"AAV3FF_00025","12":"Crustecean","13":"Anton Van de Putte","14":"https://orcid.org/0000-0003-1336-5554","15":"","16":"NA","17":"NA","18":"NA","19":"NA"},{"1":"AAV3FF_00025_stomach_020_Mucus","2":"BROKE_WEST_RMT_022_RMT8","3":"stomach content - mucus","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"AAV3FF_00025","10":"stomach content of","11":"AAV3FF_00025","12":"","13":"Anton Van de Putte","14":"https://orcid.org/0000-0003-1336-5554","15":"","16":"NA","17":"NA","18":"NA","19":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="identification" class="level3">
<h3 class="anchored" data-anchor-id="identification">Identification</h3>
<p>Identification terms are mostly part of Material table.</p>
<p>Question: I am expecting OBIS to ask about why <code>taxonID</code> and not <code>scientificNameID</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>fish_id_guide <span class="ot">&lt;-</span> <span class="st">"https://archive.org/details/fishesofsouthern00gono | Kellermann, A. (1990): Identification Key and Catalogue of Larval Antarctic Fishes , Berichte zur Polarforschung (Reports on Polar Research), Bremerhaven, Alfred Wegener Institute for Polar and Marine Research, 67 , 136 p. . doi: 10.2312/BzP_0067_1990 | https://archive.org/details/cybium-7-002-003-074"</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>identification <span class="ot">&lt;-</span> material_join_identification <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">identificationID =</span> <span class="fu">paste</span>(materialEntityID, <span class="st">"ID"</span>, <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">identificationBasedOnMaterialEntityID =</span> materialEntityID,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">identificationType =</span> <span class="st">"MaterialEntity"</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">identificationTypeIRI =</span> <span class="st">"http://rs.tdwg.org/dwc/terms/MaterialEntity"</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">identifiedBy =</span> <span class="st">"Anton Van de Putte"</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">identifiedByID =</span> <span class="st">"https://orcid.org/0000-0003-1336-5554"</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">identificationReferences =</span> fish_id_guide) <span class="sc">%&gt;%</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_dataframe_by_json</span>(<span class="st">"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/identification.json"</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(identification)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["identificationID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["identificationBasedOnMaterialEntityID"],"name":[2],"type":["chr"],"align":["left"]},{"label":["identificationType"],"name":[3],"type":["chr"],"align":["left"]},{"label":["identificationTypeIRI"],"name":[4],"type":["chr"],"align":["left"]},{"label":["verbatimIdentification"],"name":[5],"type":["chr"],"align":["left"]},{"label":["identifiedBy"],"name":[6],"type":["chr"],"align":["left"]},{"label":["identifiedByID"],"name":[7],"type":["chr"],"align":["left"]},{"label":["identificationReferences"],"name":[8],"type":["chr"],"align":["left"]},{"label":["identificationRemarks"],"name":[9],"type":["chr"],"align":["left"]},{"label":["taxonID"],"name":[10],"type":["chr"],"align":["left"]},{"label":["kingdom"],"name":[11],"type":["chr"],"align":["left"]},{"label":["scientificName"],"name":[12],"type":["chr"],"align":["left"]},{"label":["taxonRank"],"name":[13],"type":["chr"],"align":["left"]}],"data":[{"1":"AAV3FF_00322_ID","2":"AAV3FF_00322","3":"MaterialEntity","4":"http://rs.tdwg.org/dwc/terms/MaterialEntity","5":"Bathydraco sp.","6":"Anton Van de Putte","7":"https://orcid.org/0000-0003-1336-5554","8":"https://archive.org/details/fishesofsouthern00gono | Kellermann, A. (1990): Identification Key and Catalogue of Larval Antarctic Fishes , Berichte zur Polarforschung (Reports on Polar Research), Bremerhaven, Alfred Wegener Institute for Polar and Marine Research, 67 , 136 p. . doi: 10.2312/BzP_0067_1990 | https://archive.org/details/cybium-7-002-003-074","9":"closely resembles bathydraco antarcticus according to kellerman","10":"urn:lsid:marinespecies.org:taxname:234552","11":"Animalia","12":"Bathydraco","13":"Genus"},{"1":"AAV3FF_00323_ID","2":"AAV3FF_00323","3":"MaterialEntity","4":"http://rs.tdwg.org/dwc/terms/MaterialEntity","5":"Pogonophryne marmorata","6":"Anton Van de Putte","7":"https://orcid.org/0000-0003-1336-5554","8":"https://archive.org/details/fishesofsouthern00gono | Kellermann, A. (1990): Identification Key and Catalogue of Larval Antarctic Fishes , Berichte zur Polarforschung (Reports on Polar Research), Bremerhaven, Alfred Wegener Institute for Polar and Marine Research, 67 , 136 p. . doi: 10.2312/BzP_0067_1990 | https://archive.org/details/cybium-7-002-003-074","9":"","10":"urn:lsid:marinespecies.org:taxname:234730","11":"Animalia","12":"Pogonophryne marmorata","13":"Species"},{"1":"AAV3FF_00324_ID","2":"AAV3FF_00324","3":"MaterialEntity","4":"http://rs.tdwg.org/dwc/terms/MaterialEntity","5":"Cygnodraco mawsoni","6":"Anton Van de Putte","7":"https://orcid.org/0000-0003-1336-5554","8":"https://archive.org/details/fishesofsouthern00gono | Kellermann, A. (1990): Identification Key and Catalogue of Larval Antarctic Fishes , Berichte zur Polarforschung (Reports on Polar Research), Bremerhaven, Alfred Wegener Institute for Polar and Marine Research, 67 , 136 p. . doi: 10.2312/BzP_0067_1990 | https://archive.org/details/cybium-7-002-003-074","9":"","10":"urn:lsid:marinespecies.org:taxname:234834","11":"Animalia","12":"Cygnodraco mawsoni","13":"Species"},{"1":"AAV3FF_00325_ID","2":"AAV3FF_00325","3":"MaterialEntity","4":"http://rs.tdwg.org/dwc/terms/MaterialEntity","5":"Bathydraco sp.","6":"Anton Van de Putte","7":"https://orcid.org/0000-0003-1336-5554","8":"https://archive.org/details/fishesofsouthern00gono | Kellermann, A. (1990): Identification Key and Catalogue of Larval Antarctic Fishes , Berichte zur Polarforschung (Reports on Polar Research), Bremerhaven, Alfred Wegener Institute for Polar and Marine Research, 67 , 136 p. . doi: 10.2312/BzP_0067_1990 | https://archive.org/details/cybium-7-002-003-074","9":"closely resembles bathydraco antarcticus according to kellerman","10":"urn:lsid:marinespecies.org:taxname:234552","11":"Animalia","12":"Bathydraco","13":"Genus"},{"1":"AAV3FF_00326_ID","2":"AAV3FF_00326","3":"MaterialEntity","4":"http://rs.tdwg.org/dwc/terms/MaterialEntity","5":"Electrona antarctica","6":"Anton Van de Putte","7":"https://orcid.org/0000-0003-1336-5554","8":"https://archive.org/details/fishesofsouthern00gono | Kellermann, A. (1990): Identification Key and Catalogue of Larval Antarctic Fishes , Berichte zur Polarforschung (Reports on Polar Research), Bremerhaven, Alfred Wegener Institute for Polar and Marine Research, 67 , 136 p. . doi: 10.2312/BzP_0067_1990 | https://archive.org/details/cybium-7-002-003-074","9":"","10":"urn:lsid:marinespecies.org:taxname:217697","11":"Animalia","12":"Electrona antarctica","13":"Species"},{"1":"AAV3FF_00327_ID","2":"AAV3FF_00327","3":"MaterialEntity","4":"http://rs.tdwg.org/dwc/terms/MaterialEntity","5":"Electrona antarctica","6":"Anton Van de Putte","7":"https://orcid.org/0000-0003-1336-5554","8":"https://archive.org/details/fishesofsouthern00gono | Kellermann, A. (1990): Identification Key and Catalogue of Larval Antarctic Fishes , Berichte zur Polarforschung (Reports on Polar Research), Bremerhaven, Alfred Wegener Institute for Polar and Marine Research, 67 , 136 p. . doi: 10.2312/BzP_0067_1990 | https://archive.org/details/cybium-7-002-003-074","9":"","10":"urn:lsid:marinespecies.org:taxname:217697","11":"Animalia","12":"Electrona antarctica","13":"Species"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="media" class="level3">
<h3 class="anchored" data-anchor-id="media">Media</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>media_material <span class="ot">&lt;-</span> media_google <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># also needed to construct Material Media table later</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(material, <span class="at">by =</span> <span class="st">"materialEntityID"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove these media records because there is no data associated with these pictures -&gt; we don't know what these are</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(eventID)) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mediaDescription =</span> <span class="fu">str_c</span>(<span class="st">"Photo of "</span>, scientificName, <span class="st">" with its label and a grid."</span>)) </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>media <span class="ot">&lt;-</span> <span class="fu">filter_dataframe_by_json</span>(media_material, <span class="st">"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/media.json"</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(media)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["mediaID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["mediaType"],"name":[2],"type":["chr"],"align":["left"]},{"label":["accessURI"],"name":[3],"type":["chr"],"align":["left"]},{"label":["format"],"name":[4],"type":["chr"],"align":["left"]},{"label":["rights"],"name":[5],"type":["chr"],"align":["left"]},{"label":["creator"],"name":[6],"type":["chr"],"align":["left"]},{"label":["creatorID"],"name":[7],"type":["chr"],"align":["left"]},{"label":["mediaLanguage"],"name":[8],"type":["chr"],"align":["left"]},{"label":["mediaDescription"],"name":[9],"type":["chr"],"align":["left"]}],"data":[{"1":"AAV3FF_00001_01","2":"StillImage","3":"https://zenodo.org/records/14898800/files/AAV3FF_00001_01.JPG?download=1","4":"image/jpeg","5":"Public Domain","6":"Anton Van de Putte","7":"https://orcid.org/0000-0003-1336-5554","8":"eng","9":"Photo of Notolepis coatsi with its label and a grid."},{"1":"AAV3FF_00002_01","2":"StillImage","3":"https://zenodo.org/records/14898800/files/AAV3FF_00002_01.JPG?download=1","4":"image/jpeg","5":"Public Domain","6":"Anton Van de Putte","7":"https://orcid.org/0000-0003-1336-5554","8":"eng","9":"Photo of Macrouridae with its label and a grid."},{"1":"AAV3FF_00003_01","2":"StillImage","3":"https://zenodo.org/records/14898800/files/AAV3FF_00003_01.JPG?download=1","4":"image/jpeg","5":"Public Domain","6":"Anton Van de Putte","7":"https://orcid.org/0000-0003-1336-5554","8":"eng","9":"Photo of Electrona antarctica with its label and a grid."},{"1":"AAV3FF_00004_01","2":"StillImage","3":"https://zenodo.org/records/14898800/files/AAV3FF_00004_01.JPG?download=1","4":"image/jpeg","5":"Public Domain","6":"Anton Van de Putte","7":"https://orcid.org/0000-0003-1336-5554","8":"eng","9":"Photo of Notolepis coatsi with its label and a grid."},{"1":"AAV3FF_00005_01","2":"StillImage","3":"https://zenodo.org/records/14898800/files/AAV3FF_00005_01.JPG?download=1","4":"image/jpeg","5":"Public Domain","6":"Anton Van de Putte","7":"https://orcid.org/0000-0003-1336-5554","8":"eng","9":"Photo of Notolepis coatsi with its label and a grid."},{"1":"AAV3FF_00006_01","2":"StillImage","3":"https://zenodo.org/records/14898800/files/AAV3FF_00006_01.JPG?download=1","4":"image/jpeg","5":"Public Domain","6":"Anton Van de Putte","7":"https://orcid.org/0000-0003-1336-5554","8":"eng","9":"Photo of Pleuragramma antarcticum with its label and a grid."}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="survey" class="level3">
<h3 class="anchored" data-anchor-id="survey">Survey</h3>
<p>Survey table is a table that contains current Humboldt Extension terms.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>suffixes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"_RMT1"</span>,<span class="st">"_RMT8"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>survey_w_protocol <span class="ot">&lt;-</span> humboldt <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(eventID <span class="sc">!=</span> <span class="st">"BROKE_WEST"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove the expedition event, only link humboldt to the lowest level of Survey Events</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">suffix =</span> suffixes) <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">eventID =</span> <span class="fu">paste0</span>(eventID, suffix),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>         <span class="co"># need to cast netSize to string so that it can be joined later (so that it is not a double)</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">netSize =</span> <span class="fu">case_when</span>(suffix <span class="sc">==</span> <span class="st">"_RMT1"</span> <span class="sc">~</span> <span class="st">"1"</span>, suffix <span class="sc">==</span> <span class="st">"_RMT8"</span> <span class="sc">~</span> <span class="st">"8"</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span>),</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">surveyID =</span> eventID,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">isLeastSpecificTargetCategoryQuantityInclusive =</span> <span class="st">"true"</span>) </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>survey <span class="ot">&lt;-</span> survey_w_protocol <span class="sc">%&gt;%</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_dataframe_by_json</span>(<span class="st">"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/survey.json"</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(survey)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["surveyID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["eventID"],"name":[2],"type":["chr"],"align":["left"]},{"label":["siteCount"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["siteNestingDescription"],"name":[4],"type":["chr"],"align":["left"]},{"label":["verbatimSiteDescriptions"],"name":[5],"type":["chr"],"align":["left"]},{"label":["verbatimSiteNames"],"name":[6],"type":["chr"],"align":["left"]},{"label":["eventDurationUnit"],"name":[7],"type":["chr"],"align":["left"]},{"label":["isAbsenceReported"],"name":[8],"type":["chr"],"align":["left"]},{"label":["areNonTargetTaxaFullyReported"],"name":[9],"type":["chr"],"align":["left"]},{"label":["compilationTypes"],"name":[10],"type":["chr"],"align":["left"]},{"label":["inventoryTypes"],"name":[11],"type":["chr"],"align":["left"]},{"label":["protocolNames"],"name":[12],"type":["chr"],"align":["left"]},{"label":["protocolReferences"],"name":[13],"type":["chr"],"align":["left"]},{"label":["isLeastSpecificTargetCategoryQuantityInclusive"],"name":[14],"type":["chr"],"align":["left"]},{"label":["samplingPerformedBy"],"name":[15],"type":["chr"],"align":["left"]},{"label":["samplingPerformedByID"],"name":[16],"type":["chr"],"align":["left"]},{"label":["isSamplingEffortReported"],"name":[17],"type":["chr"],"align":["left"]},{"label":["samplingEffortProtocol"],"name":[18],"type":["chr"],"align":["left"]},{"label":["samplingEffortValue"],"name":[19],"type":["dbl"],"align":["right"]},{"label":["samplingEffortUnit"],"name":[20],"type":["chr"],"align":["left"]}],"data":[{"1":"BROKE_WEST_RMT_001_RMT1","2":"BROKE_WEST_RMT_001_RMT1","3":"1","4":"sampling station","5":"NA","6":"RMT_001","7":"minutes","8":"false","9":"true","10":"survey only","11":"restricted search taxonomic inventory process","12":"target trawls on acoustically detected aggregations","13":"Kawaguchi S., Nicol S., Virtue P., Davenport S., Casper R., Swadling K., Hosie G.W., 2010. Krill demography and large scale distribution in the Western Indian Ocean sector of the Southern Ocean (CCAMLR Division 58.4.2) in Austral summer of 2006. Deep-Sea Research II 57 (9â€“10), 934â€“947.","14":"true","15":"Anton Van de Putte","16":"https://orcid.org/0000-0003-1336-5554","17":"true","18":"RMT setup is described in Baker, A. de C., M. R. Clarke, and M. J. Harris. \"The NIO combination net (RMT 1+ 8) and further developments of rectangular midwater trawls.\" Journal of the Marine Biological Association of the United Kingdom 53.1 (1973): 167-184. | Towing speed is 4.5 km/h as stated in samplingEffortValue and samplingEffortUnit.","19":"4.5","20":"km/h"},{"1":"BROKE_WEST_RMT_001_RMT8","2":"BROKE_WEST_RMT_001_RMT8","3":"1","4":"sampling station","5":"NA","6":"RMT_001","7":"minutes","8":"false","9":"true","10":"survey only","11":"restricted search taxonomic inventory process","12":"target trawls on acoustically detected aggregations","13":"Kawaguchi S., Nicol S., Virtue P., Davenport S., Casper R., Swadling K., Hosie G.W., 2010. Krill demography and large scale distribution in the Western Indian Ocean sector of the Southern Ocean (CCAMLR Division 58.4.2) in Austral summer of 2006. Deep-Sea Research II 57 (9â€“10), 934â€“947.","14":"true","15":"Anton Van de Putte","16":"https://orcid.org/0000-0003-1336-5554","17":"true","18":"RMT setup is described in Baker, A. de C., M. R. Clarke, and M. J. Harris. \"The NIO combination net (RMT 1+ 8) and further developments of rectangular midwater trawls.\" Journal of the Marine Biological Association of the United Kingdom 53.1 (1973): 167-184. | Towing speed is 4.5 km/h as stated in samplingEffortValue and samplingEffortUnit.","19":"4.5","20":"km/h"},{"1":"BROKE_WEST_RMT_002_RMT1","2":"BROKE_WEST_RMT_002_RMT1","3":"1","4":"sampling station","5":"NA","6":"RMT_002","7":"minutes","8":"false","9":"true","10":"survey only","11":"restricted search taxonomic inventory process","12":"target trawls on acoustically detected aggregations","13":"Kawaguchi S., Nicol S., Virtue P., Davenport S., Casper R., Swadling K., Hosie G.W., 2010. Krill demography and large scale distribution in the Western Indian Ocean sector of the Southern Ocean (CCAMLR Division 58.4.2) in Austral summer of 2006. Deep-Sea Research II 57 (9â€“10), 934â€“947.","14":"true","15":"Anton Van de Putte","16":"https://orcid.org/0000-0003-1336-5554","17":"true","18":"RMT setup is described in Baker, A. de C., M. R. Clarke, and M. J. Harris. \"The NIO combination net (RMT 1+ 8) and further developments of rectangular midwater trawls.\" Journal of the Marine Biological Association of the United Kingdom 53.1 (1973): 167-184. | Towing speed is 4.5 km/h as stated in samplingEffortValue and samplingEffortUnit.","19":"4.5","20":"km/h"},{"1":"BROKE_WEST_RMT_002_RMT8","2":"BROKE_WEST_RMT_002_RMT8","3":"1","4":"sampling station","5":"NA","6":"RMT_002","7":"minutes","8":"false","9":"true","10":"survey only","11":"restricted search taxonomic inventory process","12":"target trawls on acoustically detected aggregations","13":"Kawaguchi S., Nicol S., Virtue P., Davenport S., Casper R., Swadling K., Hosie G.W., 2010. Krill demography and large scale distribution in the Western Indian Ocean sector of the Southern Ocean (CCAMLR Division 58.4.2) in Austral summer of 2006. Deep-Sea Research II 57 (9â€“10), 934â€“947.","14":"true","15":"Anton Van de Putte","16":"https://orcid.org/0000-0003-1336-5554","17":"true","18":"RMT setup is described in Baker, A. de C., M. R. Clarke, and M. J. Harris. \"The NIO combination net (RMT 1+ 8) and further developments of rectangular midwater trawls.\" Journal of the Marine Biological Association of the United Kingdom 53.1 (1973): 167-184. | Towing speed is 4.5 km/h as stated in samplingEffortValue and samplingEffortUnit.","19":"4.5","20":"km/h"},{"1":"BROKE_WEST_RMT_003_RMT1","2":"BROKE_WEST_RMT_003_RMT1","3":"1","4":"sampling station","5":"NA","6":"RMT_003","7":"minutes","8":"false","9":"true","10":"survey only","11":"restricted search taxonomic inventory process","12":"target trawls on acoustically detected aggregations","13":"Kawaguchi S., Nicol S., Virtue P., Davenport S., Casper R., Swadling K., Hosie G.W., 2010. Krill demography and large scale distribution in the Western Indian Ocean sector of the Southern Ocean (CCAMLR Division 58.4.2) in Austral summer of 2006. Deep-Sea Research II 57 (9â€“10), 934â€“947.","14":"true","15":"Anton Van de Putte","16":"https://orcid.org/0000-0003-1336-5554","17":"true","18":"RMT setup is described in Baker, A. de C., M. R. Clarke, and M. J. Harris. \"The NIO combination net (RMT 1+ 8) and further developments of rectangular midwater trawls.\" Journal of the Marine Biological Association of the United Kingdom 53.1 (1973): 167-184. | Towing speed is 4.5 km/h as stated in samplingEffortValue and samplingEffortUnit.","19":"4.5","20":"km/h"},{"1":"BROKE_WEST_RMT_003_RMT8","2":"BROKE_WEST_RMT_003_RMT8","3":"1","4":"sampling station","5":"NA","6":"RMT_003","7":"minutes","8":"false","9":"true","10":"survey only","11":"restricted search taxonomic inventory process","12":"target trawls on acoustically detected aggregations","13":"Kawaguchi S., Nicol S., Virtue P., Davenport S., Casper R., Swadling K., Hosie G.W., 2010. Krill demography and large scale distribution in the Western Indian Ocean sector of the Southern Ocean (CCAMLR Division 58.4.2) in Austral summer of 2006. Deep-Sea Research II 57 (9â€“10), 934â€“947.","14":"true","15":"Anton Van de Putte","16":"https://orcid.org/0000-0003-1336-5554","17":"true","18":"RMT setup is described in Baker, A. de C., M. R. Clarke, and M. J. Harris. \"The NIO combination net (RMT 1+ 8) and further developments of rectangular midwater trawls.\" Journal of the Marine Biological Association of the United Kingdom 53.1 (1973): 167-184. | Towing speed is 4.5 km/h as stated in samplingEffortValue and samplingEffortUnit.","19":"4.5","20":"km/h"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="protocol" class="level3">
<h3 class="anchored" data-anchor-id="protocol">Protocol</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>protocol <span class="ot">&lt;-</span> <span class="fu">filter_dataframe_by_json</span>(protocol, <span class="st">"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/protocol.json"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>protocol</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["protocolID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["protocolType"],"name":[2],"type":["chr"],"align":["left"]},{"label":["protocolName"],"name":[3],"type":["chr"],"align":["left"]},{"label":["protocolDescription"],"name":[4],"type":["chr"],"align":["left"]},{"label":["protocolCitation"],"name":[5],"type":["chr"],"align":["left"]}],"data":[{"1":"RMT_Target","2":"SamplingEffort","3":"target trawls on acoustically detected aggregations","4":"Fish were caught using Rectangular Midwater Trawl nets (RMT 8 + 1), consisting of a RMT 1 mounted above a RMT 8 with a mouth area of 1 and 8m2 and a cod end mesh size of 0.33 and 0.85mm, respectively. Target trawls were not pre-planned and were aimed at acoustically detected aggregations. The net was lowered to the depth of the aggregation, and opened and closed remotely.Towing speed was approximately 2.5 knots (4.5 km h-1).","5":"Kawaguchi S., Nicol S., Virtue P., Davenport S., Casper R., Swadling K., Hosie G.W., 2010. Krill demography and large scale distribution in the Western Indian Ocean sector of the Southern Ocean (CCAMLR Division 58.4.2) in Austral summer of 2006. Deep-Sea Research II 57 (9â€“10), 934â€“947."},{"1":"RMT_Routine","2":"SamplingEffort","3":"Pre-planned routine hauls with standard double oblique tow","4":"Fish were caught using Rectangular Midwater Trawl nets (RMT 8 + 1), consisting of a RMT 1 mounted above a RMT 8 with a mouth area of 1 and 8m2 and a cod end mesh size of 0.33 and 0.85mm, respectively. Routine hauls consisted of a standard double oblique tow from the surface down to 200 m and back again to the surface. Towing speed was approximately 2.5 knots (4.5 km h-1).","5":"Kawaguchi S., Nicol S., Virtue P., Davenport S., Casper R., Swadling K., Hosie G.W., 2010. Krill demography and large scale distribution in the Western Indian Ocean sector of the Southern Ocean (CCAMLR Division 58.4.2) in Austral summer of 2006. Deep-Sea Research II 57 (9â€“10), 934â€“947."},{"1":"stomach_content","2":"Measurement","3":"stomach content","4":"Formalin preserved samples and a small subsample of stomachs taken from a few larger frozen fish designated for energy measurements were analysed in the lab. Stomach content was analysed according to the method described in Pakhomov et al. (1996). Results from stomach content analyses were expressed as a percentage of each food item of the total number of food items counted (N, %)","5":"Pakhomov, E.A., Perissinotto, R., McQuaid, C.D., 1996. Prey composition and daily rations of myctophid fishes in the Southern Ocean. Mar. Ecol. Prog. Ser. 134, 1â€“14"},{"1":"dry_mass_and_energy_content","2":"Measurement","3":"Dry mass and energy content","4":"Dry mass and energy content was determined from frozen specimens. To prevent errors due to the loss of body fluids during dissection, water and energy contents were determined for whole individuals only. Only for the few larger specimens caught, stomach content was analyzed before desiccation. Frozen fish were thawed, blotted dry and total wet weight (WW) was determined to the nearest mg. Fish were freeze-dried until complete desiccation (constant mass). After drying, they were re-weighed to determine the total dry weight (DW). Water content was calculated as the difference between WW and DW, expressed as %WW. Individual DW and WW energy content, expressed as kJ g-1, was determined by an isoperibol bomb calorimeter calibrated with benzoic acid. After homogenizing, either the whole fish or a subsample (0.1â€“0.6 g) was used for calorimetry, depending on the size of the fish.","5":"Van de Putte, A.P.; Jackson, G.D.; Pakhomov, E.; Flores, H.; Volckaert, F.A.M. (2010). Distribution of squid and fish in the pelagic zone of the Cosmonaut Sea and Prydz Bay region during the BROKE-West campaign. Deep-Sea Res., Part 2, Top. Stud. Oceanogr. 57(9-10): 956-967. dx.doi.org/10.1016/j.dsr2.2008.02.015 https://doi.org/10.1016/j.dsr2.2008.02.015"},{"1":"ctd","2":"Measurement","3":"CTD","4":"The RMT net used for sampling was equipped with a CTD, providing detailed data on conductivity, temperature (C1), salinity (PSU), pressure (dBar) and fluorescence. (Gorton, 2006)","5":"GORTON, REBECCA (2006): CTD Data from the Rectangular Midwater Trawl collected during the BROKE-West voyage of the Aurora Australis, 2006. Australian Antarctic Data Centre.dataset. 10.4225/15/5988073792cf2"},{"1":"light_conditions","2":"Measurement","3":"solar azimuth, elevation and day length","4":"solar azimuth, elevation and day length were calculated as a measurement of light conditions, according to a procedure used by NOAA (Cornwall, 2007).","5":"Cornwall, C., 2007. NOAA ESRL Solar Position Calculator. http://www.srrb.noaa.gov/highlights/sunrise/azel.html (accessed 7/22/2007)"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="survey-target-occurrence" class="level3">
<h3 class="anchored" data-anchor-id="survey-target-occurrence">Survey Target &amp; Occurrence</h3>
<p>After extensive discussions on what <code>target</code> is, we decided to create survey-target table retrospectively. SurveyTarget needs to be created per net size because it is linked to a Survey (lowest level of Survey is per net size) via SurveyID. SurveyTargetAbundance points to the Survey through the SurveyTarget record.</p>
<p>Challenge: There is only total count for fish from RMT8 and not RMT1. The total count also does not contain any <code>sex</code> and <code>lifeStage</code> for all the taxa except Electrona antarctica.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>transform_rmt_count_to_long <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' Convert wide count table into long table</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' </span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @param df A tibble of the count table with taxon as columns and trawl event as rows</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @return A list of 2 tibbles, one is survey_target, the other is survey_target_abundance table</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  trawl <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">5</span><span class="sc">:</span><span class="fu">ncol</span>(df),</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"verbatimIdentification"</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"organismQuantity"</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">organismQuantityType =</span> <span class="fu">case_when</span>(organismQuantity <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"individuals"</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"individual"</span>),</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">life_stage =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(verbatimIdentification, <span class="st">" all$"</span>) <span class="sc">~</span> <span class="st">""</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(verbatimIdentification, <span class="st">" Larvae$"</span>) <span class="sc">~</span> <span class="st">"Larvae"</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(verbatimIdentification, <span class="st">" Postmeta$"</span>) <span class="sc">~</span> <span class="st">"Postmeta"</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">lifeStage =</span> life_stage, <span class="co"># create extra lifeStage column for occurrence table</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># use field name "taxon" for surveyTargetType vocabulary later</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">taxon =</span> <span class="fu">str_remove_all</span>(verbatimIdentification, <span class="st">"</span><span class="sc">\\</span><span class="st">s*(all|Larvae|Postmeta|sp</span><span class="sc">\\</span><span class="st">.)$"</span>),</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">station_number_cleaned =</span> <span class="fu">str_remove_all</span>(<span class="st">`</span><span class="at">Station number</span><span class="st">`</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">s*"</span>), <span class="co"># Remove white spaces</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">surveyID =</span> <span class="fu">str_c</span>(<span class="st">"BROKE_WEST_RMT_"</span>, station_number_cleaned, <span class="st">"_RMT8"</span>),</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># need to cast body size to string otherwise double cannot be in the same column with string after pivot_long</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># only use size range for RMT8 here because there is no count data for RMT1 </span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">minimum body size</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"0.85"</span>,</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">maximum body size</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"3"</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>trawl_taxa <span class="ot">&lt;-</span> <span class="fu">wm_records_names</span>(<span class="fu">unique</span>(trawl<span class="sc">$</span>taxon)) <span class="sc">%&gt;%</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the taxon match returns list of lists, this function creates a table of the following fields out of the lists</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_df</span>(<span class="sc">~</span> <span class="fu">select</span>(.x, scientificname, lsid, AphiaID, rank, kingdom)) <span class="sc">%&gt;%</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">taxon =</span> scientificname, <span class="at">taxonID =</span> lsid, <span class="at">taxonRank =</span> rank) <span class="sc">%&gt;%</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">taxon_rank =</span> taxonRank) <span class="co"># create extra taxonRank column for occurrence table</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>trawl_count <span class="ot">&lt;-</span> trawl <span class="sc">%&gt;%</span> </span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(trawl_taxa, <span class="at">by =</span> <span class="st">"taxon"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">surveyTargetID =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    lifeStage <span class="sc">!=</span> <span class="st">""</span> <span class="sc">~</span> <span class="fu">str_c</span>(AphiaID, lifeStage, <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(AphiaID)))</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>trawl_long <span class="ot">&lt;-</span> trawl_count <span class="sc">%&gt;%</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"taxon"</span>, <span class="st">"life_stage"</span>, <span class="st">"taxon_rank"</span>, <span class="st">"minimum body size"</span>, <span class="st">"maximum body size"</span>),</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"surveyTargetType"</span>,</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"surveyTargetValue"</span>,</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_drop_na =</span> <span class="cn">TRUE</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">surveyTargetUnit =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>      surveyTargetType <span class="sc">==</span> <span class="st">"minimum body size"</span> <span class="sc">~</span> <span class="st">"mm"</span>,</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>      surveyTargetType <span class="sc">==</span> <span class="st">"maximum body size"</span> <span class="sc">~</span> <span class="st">"m"</span>,</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">surveyTargetUnitIRI =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>      surveyTargetUnit <span class="sc">==</span> <span class="st">"mm"</span> <span class="sc">~</span> <span class="st">"http://vocab.nerc.ac.uk/collection/P06/current/UXMM/"</span>,</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>      surveyTargetUnit <span class="sc">==</span> <span class="st">"m"</span> <span class="sc">~</span> <span class="st">"http://vocab.nerc.ac.uk/collection/P06/current/ULAA/"</span>,</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">surveyTargetValueIRI =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>      surveyTargetType <span class="sc">==</span> <span class="st">"taxon"</span> <span class="sc">~</span> taxonID,</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>      surveyTargetValue <span class="sc">==</span> <span class="st">"Genus"</span> <span class="sc">~</span> <span class="st">"http://rs.tdwg.org/dwc/terms/genus"</span>,</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>      surveyTargetValue <span class="sc">==</span> <span class="st">"Species"</span> <span class="sc">~</span> <span class="st">"http://rs.tdwg.org/dwc/terms/specificEpithet"</span>,</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>      surveyTargetValue <span class="sc">==</span> <span class="st">"Family"</span> <span class="sc">~</span> <span class="st">"http://rs.tdwg.org/dwc/terms/family"</span>,</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">surveyTargetType =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>      surveyTargetType <span class="sc">==</span> <span class="st">"life_stage"</span> <span class="sc">~</span> <span class="st">"life stage"</span>,</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>      surveyTargetType <span class="sc">==</span> <span class="st">"taxon_rank"</span> <span class="sc">~</span> <span class="st">"taxon rank"</span>,</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> surveyTargetType</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">includeOrExclude =</span> <span class="st">"include"</span>,</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">isSurveyTargetFullyReported =</span> <span class="st">"true"</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>(surveyTargetType <span class="sc">==</span> <span class="st">"life stage"</span> <span class="sc">&amp;</span> surveyTargetValue <span class="sc">==</span> <span class="st">""</span>)) <span class="co"># remove empty lifeStage row</span></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>survey_target <span class="ot">&lt;-</span> trawl_long <span class="sc">%&gt;%</span></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(surveyTargetID, surveyID, surveyTargetType, surveyTargetValue, surveyTargetValueIRI, surveyTargetUnit, surveyTargetUnitIRI)</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>occurrence <span class="ot">&lt;-</span> trawl_long <span class="sc">%&gt;%</span></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(surveyTargetType <span class="sc">==</span> <span class="st">"taxon"</span> <span class="sc">&amp;</span> organismQuantity <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">scientificName =</span> surveyTargetValue, </span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">eventID =</span> surveyID) <span class="sc">%&gt;%</span></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">occurrenceStatus =</span> <span class="st">"present"</span>,</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">recordedBy =</span> <span class="st">"Anton Van de Putte"</span>,</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">recordedByID =</span> <span class="st">"https://orcid.org/0000-0003-1336-5554"</span>,</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">identifiedBy =</span> <span class="st">"Anton Van de Putte"</span>,</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">identifiedByID =</span> <span class="st">"https://orcid.org/0000-0003-1336-5554"</span>,</span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(<span class="fu">list</span>(<span class="at">survey_target =</span> survey_target, <span class="at">occurrence =</span> occurrence))</span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>routine_trawl <span class="ot">&lt;-</span> <span class="fu">transform_rmt_count_to_long</span>(raw_count_routine)</span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>target_trawl <span class="ot">&lt;-</span> <span class="fu">transform_rmt_count_to_long</span>(raw_count_target)</span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>survey_target <span class="ot">&lt;-</span> <span class="fu">rbind</span>(routine_trawl<span class="sc">$</span>survey_target, target_trawl<span class="sc">$</span>survey_target) <span class="sc">%&gt;%</span></span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_dataframe_by_json</span>(<span class="st">"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/survey-target.json"</span>)</span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>occurrence <span class="ot">&lt;-</span> <span class="fu">rbind</span>(routine_trawl<span class="sc">$</span>occurrence, target_trawl<span class="sc">$</span>occurrence) <span class="sc">%&gt;%</span></span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">occurrenceID =</span> <span class="fu">str_c</span>(eventID, surveyTargetID, <span class="at">sep =</span> <span class="st">"_"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_dataframe_by_json</span>(<span class="st">"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/occurrence.json"</span>)</span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a><span class="co"># preview example tables</span></span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(survey_target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["surveyTargetID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["surveyID"],"name":[2],"type":["chr"],"align":["left"]},{"label":["surveyTargetType"],"name":[3],"type":["chr"],"align":["left"]},{"label":["surveyTargetValue"],"name":[4],"type":["chr"],"align":["left"]},{"label":["surveyTargetValueIRI"],"name":[5],"type":["chr"],"align":["left"]},{"label":["surveyTargetUnit"],"name":[6],"type":["chr"],"align":["left"]},{"label":["surveyTargetUnitIRI"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"217697","2":"BROKE_WEST_RMT_004_RMT8","3":"taxon","4":"Electrona antarctica","5":"urn:lsid:marinespecies.org:taxname:217697","6":"NA","7":"NA"},{"1":"217697","2":"BROKE_WEST_RMT_004_RMT8","3":"taxon rank","4":"Species","5":"http://rs.tdwg.org/dwc/terms/specificEpithet","6":"NA","7":"NA"},{"1":"217697","2":"BROKE_WEST_RMT_004_RMT8","3":"minimum body size","4":"0.85","5":"NA","6":"mm","7":"http://vocab.nerc.ac.uk/collection/P06/current/UXMM/"},{"1":"217697","2":"BROKE_WEST_RMT_004_RMT8","3":"maximum body size","4":"3","5":"NA","6":"m","7":"http://vocab.nerc.ac.uk/collection/P06/current/ULAA/"},{"1":"217697_Larvae","2":"BROKE_WEST_RMT_004_RMT8","3":"taxon","4":"Electrona antarctica","5":"urn:lsid:marinespecies.org:taxname:217697","6":"NA","7":"NA"},{"1":"217697_Larvae","2":"BROKE_WEST_RMT_004_RMT8","3":"life stage","4":"Larvae","5":"NA","6":"NA","7":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(occurrence)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["occurrenceID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["eventID"],"name":[2],"type":["chr"],"align":["left"]},{"label":["recordedBy"],"name":[3],"type":["chr"],"align":["left"]},{"label":["recordedByID"],"name":[4],"type":["chr"],"align":["left"]},{"label":["organismQuantity"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["organismQuantityType"],"name":[6],"type":["chr"],"align":["left"]},{"label":["lifeStage"],"name":[7],"type":["chr"],"align":["left"]},{"label":["occurrenceStatus"],"name":[8],"type":["chr"],"align":["left"]},{"label":["verbatimIdentification"],"name":[9],"type":["chr"],"align":["left"]},{"label":["identifiedBy"],"name":[10],"type":["chr"],"align":["left"]},{"label":["identifiedByID"],"name":[11],"type":["chr"],"align":["left"]},{"label":["taxonID"],"name":[12],"type":["chr"],"align":["left"]},{"label":["kingdom"],"name":[13],"type":["chr"],"align":["left"]},{"label":["scientificName"],"name":[14],"type":["chr"],"align":["left"]},{"label":["taxonRank"],"name":[15],"type":["chr"],"align":["left"]}],"data":[{"1":"BROKE_WEST_RMT_007_RMT8_125471","2":"BROKE_WEST_RMT_007_RMT8","3":"Anton Van de Putte","4":"https://orcid.org/0000-0003-1336-5554","5":"1","6":"individuals","7":"","8":"present","9":"Macrouridae","10":"Anton Van de Putte","11":"https://orcid.org/0000-0003-1336-5554","12":"urn:lsid:marinespecies.org:taxname:125471","13":"Animalia","14":"Macrouridae","15":"Family"},{"1":"BROKE_WEST_RMT_008_RMT8_217697","2":"BROKE_WEST_RMT_008_RMT8","3":"Anton Van de Putte","4":"https://orcid.org/0000-0003-1336-5554","5":"1","6":"individuals","7":"","8":"present","9":"Electrona antarctica all","10":"Anton Van de Putte","11":"https://orcid.org/0000-0003-1336-5554","12":"urn:lsid:marinespecies.org:taxname:217697","13":"Animalia","14":"Electrona antarctica","15":"Species"},{"1":"BROKE_WEST_RMT_008_RMT8_217697_Larvae","2":"BROKE_WEST_RMT_008_RMT8","3":"Anton Van de Putte","4":"https://orcid.org/0000-0003-1336-5554","5":"1","6":"individuals","7":"Larvae","8":"present","9":"Electrona antarctica Larvae","10":"Anton Van de Putte","11":"https://orcid.org/0000-0003-1336-5554","12":"urn:lsid:marinespecies.org:taxname:217697","13":"Animalia","14":"Electrona antarctica","15":"Species"},{"1":"BROKE_WEST_RMT_008_RMT8_234695","2":"BROKE_WEST_RMT_008_RMT8","3":"Anton Van de Putte","4":"https://orcid.org/0000-0003-1336-5554","5":"1","6":"individuals","7":"","8":"present","9":"Notolepis coatsi","10":"Anton Van de Putte","11":"https://orcid.org/0000-0003-1336-5554","12":"urn:lsid:marinespecies.org:taxname:234695","13":"Animalia","14":"Notolepis coatsi","15":"Species"},{"1":"BROKE_WEST_RMT_011_RMT8_234695","2":"BROKE_WEST_RMT_011_RMT8","3":"Anton Van de Putte","4":"https://orcid.org/0000-0003-1336-5554","5":"2","6":"individuals","7":"","8":"present","9":"Notolepis coatsi","10":"Anton Van de Putte","11":"https://orcid.org/0000-0003-1336-5554","12":"urn:lsid:marinespecies.org:taxname:234695","13":"Animalia","14":"Notolepis coatsi","15":"Species"},{"1":"BROKE_WEST_RMT_011_RMT8_234721","2":"BROKE_WEST_RMT_011_RMT8","3":"Anton Van de Putte","4":"https://orcid.org/0000-0003-1336-5554","5":"1","6":"individuals","7":"","8":"present","9":"Pleuragramma antarcticum","10":"Anton Van de Putte","11":"https://orcid.org/0000-0003-1336-5554","12":"urn:lsid:marinespecies.org:taxname:234721","13":"Animalia","14":"Pleuragramma antarcticum","15":"Species"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
</section>
<section id="common-tables" class="level2">
<h2 class="anchored" data-anchor-id="common-tables">Common tables</h2>
<section id="agent-role" class="level3">
<h3 class="anchored" data-anchor-id="agent-role">Agent role</h3>
<section id="agent-agent-role" class="level4">
<h4 class="anchored" data-anchor-id="agent-agent-role">Agent Agent role</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>agent_agent_role <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">agentID =</span> <span class="st">"https://orcid.org/0000-0003-1336-5554"</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">agentRole =</span> <span class="st">"collector"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">filter_dataframe_by_json</span>(<span class="st">"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/agent-agent-role.json"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>agent_agent_role</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["agentID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["agentRole"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"https://orcid.org/0000-0003-1336-5554","2":"collector"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="table-not-needed-event-agent-role" class="level4">
<h4 class="anchored" data-anchor-id="table-not-needed-event-agent-role">Table not needed: Event Agent role</h4>
</section>
<section id="table-not-needed-identification-agent-role" class="level4">
<h4 class="anchored" data-anchor-id="table-not-needed-identification-agent-role">Table not needed: Identification Agent role</h4>
<p>The <code>event_agent_roles</code> and <code>identification_agent_roles</code> arenâ€™t actually necessary because those roles are hard-wired elsewhere in the schema in a simpler way. Specifically, identification has <code>identifiedBy</code> and <code>identifiedByID</code>, which can be populated directly with the name and the ORCID. Similarly with <code>collectedBy</code> and <code>collectorID</code> in the <code>material</code> table.</p>
</section>
<section id="table-not-needed-survey-agent-role" class="level4">
<h4 class="anchored" data-anchor-id="table-not-needed-survey-agent-role">Table not needed: Survey Agent role</h4>
<p>Not needed because it can be represented by <code>samplingPerformedBy</code> and <code>samplingPerformedByID</code>.</p>
</section>
</section>
<section id="assertion" class="level3">
<h3 class="anchored" data-anchor-id="assertion">Assertion</h3>
<section id="event-assertion" class="level4">
<h4 class="anchored" data-anchor-id="event-assertion">Event Assertion</h4>
<p>Placing environmental measurements under Event Assertion instead of Survey Assertion because it is for both RMT1 and RMT8. Putting this at the level of station Event and not net Event.</p>
<pre><code>Expedition
|__ Sampling station
    |__ RMT1
    |__ RMT8</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>assertion <span class="ot">&lt;-</span> emof <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">assertionID =</span> measurementID, <span class="at">assertionType =</span> measurementType, <span class="at">assertionTypeIRI =</span> measurementTypeID, <span class="at">assertionValueIRI =</span> measurementValueID, <span class="at">assertionUnit =</span> measurementUnit, <span class="at">assertionUnitIRI =</span> measurementUnitID) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">assertionValue =</span> <span class="fu">if_else</span>(<span class="fu">grepl</span>(<span class="st">"[a-zA-Z]"</span>, measurementValue), measurementValue, <span class="cn">NA</span>),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">assertionValueNumeric =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"[a-zA-Z]"</span>, measurementValue), <span class="fu">as.numeric</span>(measurementValue), <span class="cn">NA</span>))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>event_assertion <span class="ot">&lt;-</span> assertion <span class="sc">%&gt;%</span> </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(occurrenceID)) <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">assertionTypeVocabulary =</span> <span class="st">"http://vocab.nerc.ac.uk/collection/P01/current/"</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">assertionProtocol =</span> <span class="fu">case_when</span>(</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>      assertionType <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Average temperature"</span>, <span class="st">"Maximum Pressure"</span>, <span class="st">"Average Salinity"</span>, <span class="st">"Average Conductivity"</span>, <span class="st">"Average fluoresence"</span>) <span class="sc">~</span> <span class="st">"CTD"</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>      assertionType <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Solar Azimuth"</span>, <span class="st">"Solar elevation"</span>, <span class="st">"daylength"</span>) <span class="sc">~</span> <span class="st">"solar azimuth, elevation and day length"</span>,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span>),</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">assertionProtocolID =</span> <span class="fu">case_when</span>(</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>      assertionProtocol <span class="sc">==</span> <span class="st">"CTD"</span> <span class="sc">~</span> <span class="st">"ctd"</span>,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>      assertionProtocol <span class="sc">==</span> <span class="st">"solar azimuth, elevation and day length"</span> <span class="sc">~</span> <span class="st">"light_conditions"</span>,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span>),</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">assertionUnitVocabulary =</span> <span class="st">"http://vocab.nerc.ac.uk/collection/P06/current/"</span> </span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_dataframe_by_json</span>(<span class="st">"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/event-assertion.json"</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>event_assertion <span class="sc">%&gt;%</span> <span class="fu">filter</span>(assertionID <span class="sc">==</span> <span class="st">"BROKE_WEST_RMT_028_temp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["assertionID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["eventID"],"name":[2],"type":["chr"],"align":["left"]},{"label":["assertionType"],"name":[3],"type":["chr"],"align":["left"]},{"label":["assertionTypeIRI"],"name":[4],"type":["chr"],"align":["left"]},{"label":["assertionTypeVocabulary"],"name":[5],"type":["chr"],"align":["left"]},{"label":["assertionValue"],"name":[6],"type":["chr"],"align":["left"]},{"label":["assertionValueIRI"],"name":[7],"type":["chr"],"align":["left"]},{"label":["assertionValueNumeric"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["assertionUnit"],"name":[9],"type":["chr"],"align":["left"]},{"label":["assertionUnitIRI"],"name":[10],"type":["chr"],"align":["left"]},{"label":["assertionUnitVocabulary"],"name":[11],"type":["chr"],"align":["left"]},{"label":["assertionProtocol"],"name":[12],"type":["chr"],"align":["left"]},{"label":["assertionProtocolID"],"name":[13],"type":["chr"],"align":["left"]}],"data":[{"1":"BROKE_WEST_RMT_028_temp","2":"BROKE_WEST_RMT_028","3":"Average temperature","4":"http://vocab.nerc.ac.uk/collection/P01/current/TSAMP001","5":"http://vocab.nerc.ac.uk/collection/P01/current/","6":"NA","7":"NA","8":"-1.420631","9":"degC","10":"http://vocab.nerc.ac.uk/collection/P06/current/UPAA/","11":"http://vocab.nerc.ac.uk/collection/P06/current/","12":"CTD","13":"ctd"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="material-assertion" class="level4">
<h4 class="anchored" data-anchor-id="material-assertion">Material Assertion</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>material_assertion <span class="ot">&lt;-</span> assertion <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(occurrenceID)) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">materialEntityID =</span> occurrenceID) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_dataframe_by_json</span>(<span class="st">"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/material-assertion.json"</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>material_assertion <span class="sc">%&gt;%</span> <span class="fu">filter</span>(materialEntityID <span class="sc">==</span> <span class="st">"AAV3FF_00001"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["assertionID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["materialEntityID"],"name":[2],"type":["chr"],"align":["left"]},{"label":["assertionType"],"name":[3],"type":["chr"],"align":["left"]},{"label":["assertionTypeIRI"],"name":[4],"type":["chr"],"align":["left"]},{"label":["assertionValue"],"name":[5],"type":["chr"],"align":["left"]},{"label":["assertionValueIRI"],"name":[6],"type":["chr"],"align":["left"]},{"label":["assertionValueNumeric"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["assertionUnit"],"name":[8],"type":["chr"],"align":["left"]},{"label":["assertionUnitIRI"],"name":[9],"type":["chr"],"align":["left"]}],"data":[{"1":"AAV3FF_00001_SL","2":"AAV3FF_00001","3":"Standard Length","4":"http://vocab.nerc.ac.uk/collection/P01/current/SL01XX01","5":"NA","6":"NA","7":"41","8":"mm","9":"http://vocab.nerc.ac.uk/collection/P06/current/UXMM/"},{"1":"AAV3FF_00001_TL","2":"AAV3FF_00001","3":"Total Length","4":"http://vocab.nerc.ac.uk/collection/P01/current/OBSINDLX","5":"NA","6":"NA","7":"43","8":"mm","9":"http://vocab.nerc.ac.uk/collection/P06/current/UXMM/"},{"1":"AAV3FF_00001_presrvation","2":"AAV3FF_00001","3":"Preservation Method","4":"NA","5":"Ethanol","6":"NA","7":"NA","8":"NA","9":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
</section>
<section id="media-1" class="level3">
<h3 class="anchored" data-anchor-id="media-1">Media</h3>
<section id="material-media" class="level4">
<h4 class="anchored" data-anchor-id="material-media">Material Media</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>material_media <span class="ot">&lt;-</span> media_material <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mediaSubjectCategory =</span> <span class="st">"specimen photo"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_dataframe_by_json</span>(<span class="st">"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/material-media.json"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(material_media)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["mediaID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["materialEntityID"],"name":[2],"type":["chr"],"align":["left"]},{"label":["mediaSubjectCategory"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"AAV3FF_00001_01","2":"AAV3FF_00001","3":"specimen photo"},{"1":"AAV3FF_00002_01","2":"AAV3FF_00002","3":"specimen photo"},{"1":"AAV3FF_00003_01","2":"AAV3FF_00003","3":"specimen photo"},{"1":"AAV3FF_00004_01","2":"AAV3FF_00004","3":"specimen photo"},{"1":"AAV3FF_00005_01","2":"AAV3FF_00005","3":"specimen photo"},{"1":"AAV3FF_00006_01","2":"AAV3FF_00006","3":"specimen photo"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
</section>
<section id="protocol-1" class="level3">
<h3 class="anchored" data-anchor-id="protocol-1">Protocol</h3>
<section id="survey-protocol" class="level4">
<h4 class="anchored" data-anchor-id="survey-protocol">Survey Protocol</h4>
<p>As Event is also a Survey, I use Survey Protocol table instead of Event Protocol table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>survey_protocol <span class="ot">&lt;-</span> survey_w_protocol <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(surveyID, samplingProtocol) <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">protocolID =</span> samplingProtocol) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(protocolID))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>survey_protocol <span class="sc">%&gt;%</span> <span class="fu">filter</span>(surveyID <span class="sc">==</span> <span class="st">"BROKE_WEST_RMT_001_RMT8"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["surveyID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["protocolID"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"BROKE_WEST_RMT_001_RMT8","2":"RMT_Target"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
</section>
<section id="identifier" class="level3">
<h3 class="anchored" data-anchor-id="identifier">Identifier</h3>
<section id="agent-identifier" class="level4">
<h4 class="anchored" data-anchor-id="agent-identifier">Agent Identifier</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>agent_identifier <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">identifier =</span> <span class="st">"https://orcid.org/0000-0003-1336-5554"</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">agentID =</span> <span class="st">"https://orcid.org/0000-0003-1336-5554"</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">identifierType =</span> <span class="st">"ORCID"</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">identifierLanguage =</span> <span class="st">"eng"</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">filter_dataframe_by_json</span>(<span class="st">"https://rs.gbif.org/sandbox/experimental/data-packages/dwc-dp/0.1/table-schemas/agent-identifier.json"</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>agent_identifier</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["identifier"],"name":[1],"type":["chr"],"align":["left"]},{"label":["agentID"],"name":[2],"type":["chr"],"align":["left"]},{"label":["identifierType"],"name":[3],"type":["chr"],"align":["left"]},{"label":["identifierLanguage"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"https://orcid.org/0000-0003-1336-5554","2":"https://orcid.org/0000-0003-1336-5554","3":"ORCID","4":"eng"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./dataset-background.html" class="pagination-link" aria-label="Dataset background">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Dataset background</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./explore-dwc-dp.html" class="pagination-link" aria-label="Exploring DwC-DP">
        <span class="nav-page-text">Exploring DwC-DP</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>